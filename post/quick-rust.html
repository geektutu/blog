<!DOCTYPE html>
<html lang="zh-CN">

<!-- Head tag -->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="referrer" content="no-referrer-when-downgrade">
  
  <meta name="baidu-site-verification" content="p7Pz3jlx4t" />
  <meta name="google-site-verification" content="X31OY0d2sKImNbS2x8-OpITWRK4nn7nZCcXe3_hA9ew" />
  <meta name="msvalidate.01" content="7E2AEE3378AC93764DEAB411177A21A1" />
  <meta name="360-site-verification" content="1d1e81a1a48a1ed2e3308d7cb8e548e7" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- if page has tags, then add tags to keyword -->
  
  
  <meta name="keywords" content="geektutu,jiketutu,Go语言,golang,python,Rust,Rust语言,Rust程序设计,Rust教程中文版">
  <!-- page.description has higher priority -->
  <meta name="description" content="Rust简明教程，Rust入门教程，Rust 是一门系统编程语言(Systems Programming Language)，兼顾安全(Safety)、性能(Speed)和并发(Concurrency)。包括 Rust 和 Cargo 安装、基本类型(字符串str，整形等)、控制流(if, if let, while let, loop, for循环等)、复杂类型(struct, enum等)，以及错误处理(panic, Result)，Cargo 项目的代码结构，如何测试 Rust 代码等。">
  <link rel="shortcut icon" href="/img/icon.png">
  <title>
    
    Rust 简明教程 | 快速入门 | 极客兔兔
    
  </title>

  <link rel="canonical" href="https://geektutu.com/post/quick-rust.html">
  
<link rel="stylesheet" href="/css/geektutu.css">

  <!-- global function -->
  <script>
    window.globalAddScript = function (url, onload, onerror) {
      var s = document.createElement('script');
      s.src = url;
      onload && (s.onload = onload);
      onerror && (s.onerror = onerror);
      document.body.appendChild(s);
    }
    window.globalAddCss = function (url) {
      var s = document.createElement('link');
      s.rel = 'stylesheet';
      s.href = url;
      document.body.appendChild(s);
    }
    window.getPosition = function (ele) {
      var x = 0, y = 0;
      while (ele) {
        x += (ele.offsetLeft - ele.scrollLeft + ele.clientLeft);
        y += (ele.offsetTop - ele.scrollTop + ele.clientTop);
        ele = ele.offsetParent;
      }
      return { x: x, y: y };
    }
    window.getDom = function (str) { return document.querySelector(str) }
  </script>
  <!-- google ad -->
  
<meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/feed.xml" title="极客兔兔" type="application/rss+xml">
</head>

<body>
    
<header class="gkt-header col-xs-12 padding-0">
    <div id="gkt-nav" class="gkt-header-container">
        <a href="/" class="gkt-header-title float-left">
            <img class="float-left" src="/img/icon.png" alt="">
            <span>极客兔兔</span>
        </a>
        <nav class="gkt-header-nav text-right">
            <ul>
                <li><a class="hidden-xs" href="/feed.xml">订阅</a></li>
                <li><a href="/series/">专题</a></li>
                <li><a href="/archives/">归档</a></li>
                <li><a href="/post/link.html">友链</a></li>
                <li><a href="/post/about.html">关于</a></li>
            </ul>
        </nav>
    </div>
    <div id="gkt-cate-nav" class="gkt-header-container hidden-xs">
        
        <nav class="gkt-header-nav float-left">
            <ul>
                
                
                <li class="gkt-cate-name float-left active">
                    <a class="float-left" href="/post/tensorflow-mnist-simplest.html">简明教程 ▾</a>
                    
                    <ul class="gkt-sub-cate">
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/tensorflow-mnist-simplest.html">TensorFlow 教程</a></li>
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/pandas-dataframe-series.html">Pandas 数据处理</a></li>
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/tf2doc.html">TensorFlow2 文档</a></li>
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/quick-golang.html">Go 简明教程</a></li>
                        
                        <li class="gkt-sub-cate-name active"><a class="float-left"
                                href="/post/quick-rust.html">Rust 简明教程</a></li>
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/quick-python.html">Python 简明教程</a></li>
                        
                    </ul>
                    
                </li>
                
                <li class="gkt-cate-name float-left ">
                    <a class="float-left" href="/post/blog-experience-1.html">杂谈 ▾</a>
                    
                    <ul class="gkt-sub-cate">
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/blog-experience-1.html">建站经历</a></li>
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/2020.html">年终总结</a></li>
                        
                    </ul>
                    
                </li>
                
                <li class="gkt-cate-name float-left ">
                    <a class="float-left" href="/post/qa-ml.html">面试 ▾</a>
                    
                    <ul class="gkt-sub-cate">
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/qa-ml.html">机器学习面试题</a></li>
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/qa-golang.html">Go 语言面试题</a></li>
                        
                    </ul>
                    
                </li>
                
                <li class="gkt-cate-name float-left ">
                    <a class="float-left" href="/post/gee.html">从零实现 ▾</a>
                    
                    <ul class="gkt-sub-cate">
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/gee.html">Web框架 - Gee</a></li>
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/geecache.html">分布式缓存 - GeeCache</a></li>
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/geeorm.html">ORM框架 - GeeORM</a></li>
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/geerpc.html">RPC框架 - GeeRPC</a></li>
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/7days-golang-q1.html">7days-golang Q &amp; A</a></li>
                        
                    </ul>
                    
                </li>
                
                <li class="gkt-cate-name float-left ">
                    <a class="float-left" href="/post/box-tools.html">百宝箱 ▾</a>
                    
                    <ul class="gkt-sub-cate">
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/box-tools.html">工具</a></li>
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/cheat-sheet-sqlite.html">SQLite 速查表</a></li>
                        
                    </ul>
                    
                </li>
                
                <li class="gkt-cate-name float-left ">
                    <a class="float-left" href="/post/high-performance-go.html">高性能编程 ▾</a>
                    
                    <ul class="gkt-sub-cate">
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/high-performance-go.html">序言</a></li>
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/hpg-benchmark.html">性能分析</a></li>
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/hpg-string-concat.html">常用数据结构</a></li>
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/hpg-mutex.html">并发编程</a></li>
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/hpg-reduce-size.html">编译优化</a></li>
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/hpg-gotchas-array-slice.html">语言陷阱</a></li>
                        
                    </ul>
                    
                </li>
                
            </ul>
        </nav>
    </div>
</header>
<div class="gkt-header-placeholder" style="height: 44px"></div>
<div class="gkt-header-placeholder hidden-xs" style="height: 44px"></div>
<script>
    (function () {
        window.addEventListener('scroll', function () {
            if (window.innerWidth < 768) {
                return;
            }
            var nav = document.querySelector('#gkt-nav');
            var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
            scrollTop > 50 && (nav.classList.add('hide'));
            scrollTop <= 50 && (nav.classList.remove('hide'));
        });
        var cateNavs = document.querySelectorAll('#gkt-cate-nav>nav>ul>li');
        [].slice.call(cateNavs).forEach(function (item) {
            var sub = item.querySelector('.gkt-sub-cate');
            if (!sub) return;
            item.addEventListener('mouseenter', function (e) { sub.style.display = 'block'; }, false);
            item.addEventListener('mouseleave', function (e) { sub.style.display = 'none'; }, false);
        })
    })();
</script>
    <!-- Main Content -->
    <div class="main-container">
        <!-- Main Content -->
<main class="col-xs-12 padding-0 markdown-it">
    <!-- Post Container -->
    
    
    <!-- Post Content -->
<div class="float-left post-container box-shadow">
    <div class="u-arrow-wrapper hidden-xs">
        
        <a class="float-left" href="/post/gee-day6.html"><i class="u-arrow-left"></i></a>
        
        
        <a class="float-right" href="/post/awesome-config.html"><i class="u-arrow-right"></i></a>
        
    </div>
    <article class="col-xs-12">
        <h1> Rust 简明教程 </h1>
        
        
        <div class="hidden-lg hidden-md series_links">
            <p> <strong> Rust 简明教程系列文章链接：</strong></p>
            <ul>
                
                <li>
                    <a href="/post/quick-rust.html">Rust 简明教程</a>
                    <span class="post-item-date">(Nov 24, 2019)</span>
                </li>
                
            </ul>
        </div>
        
        
        <div class="gkt-article-start"></div>
        <p>Rust 是一门系统编程语言(Systems Programming Language)，兼顾安全(Safety)、性能(Speed)和并发(Concurrency)。Rust作为一门底层的系统编程语言，理论上，使用 C/C++ 的领域都可以使用Rust实现，例如对硬件需要精细控制的嵌入式编程、对性能要求极高的应用软件（数据库引擎、浏览器引擎，3D渲染引擎等）。相对于 C/C++ 的系统性缺陷（内存管理不当造成的安全漏洞），Rust通过所有权(Ownership)机制在编译期间确保内存安全，无需垃圾回收(Garbage Collection, GC)，也不需要手动释放内存。</p>
<h2 id="1-Hello-World"><a href="#1-Hello-World" class="headerlink" title="1. Hello World"></a>1. Hello World</h2><h3 id="1-1-安装-Rust"><a href="#1-1-安装-Rust" class="headerlink" title="1.1 安装 Rust"></a>1.1 安装 Rust</h3><ul>
<li><p>在线安装</p>
<ul>
<li>Windows：下载 <a target="_blank" rel="noopener" href="https://rust-lang.org/tools/install">rustup-init.exe</a>，自动引导安装。</li>
<li>Linux：<em>curl –proto ‘=https’ –tlsv1.2 -sSf <a target="_blank" rel="noopener" href="https://sh.rustup.rs/">https://sh.rustup.rs</a> | sh</em></li>
</ul>
</li>
<li><p>离线安装</p>
<ul>
<li>下载<a target="_blank" rel="noopener" href="https://forge.rust-lang.org/infra/other-installation-methods.html#standalone-installers">独立安装包</a></li>
<li>Windows: 下载 .msi 文件，双击安装即可。</li>
<li>Linux：下载 .tar.gz 文件，<em>tar -xvf xxx.tar.gz</em> 解压后，执行 install.sh 即可。 </li>
</ul>
</li>
<li><p>查看版本</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ rustc --version</span><br><span class="line">rustc 1.39.0 (4560ea788 2019-11-04)</span><br><span class="line">$ cargo --version</span><br><span class="line">cargo 1.39.0 (1c6ec66d5 2019-09-30)</span><br></pre></td></tr></table></figure>

<h3 id="1-2-第一个Rust程序"><a href="#1-2-第一个Rust程序" class="headerlink" title="1.2 第一个Rust程序"></a>1.2 第一个Rust程序</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello, world!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用 <code>fn</code> 声明函数。与大部分编程语言一致，<code>main()</code> 是 Rust 程序的入口。<code>println!</code> 表示打印文本到控制台，<code>!</code> 表示这是一个宏(macro)，而非一个函数(function)。</p>
<ul>
<li>保存为 hello_world.rs，rs 为 Rust 语言的后缀。</li>
<li>编译：<em>rustc hello_world.rs</em>。</li>
<li>执行：*./hello_world<em>（Linux），</em>hello_world.exe*(Windows)</li>
</ul>
<p>尝试下 <em>println!</em> 更多的用法。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;, &#123;&#125;!&quot;</span>, <span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;world&quot;</span>); <span class="comment">// Hello, world!</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;0&#125;, &#123;1&#125;!&quot;</span>, <span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;world&quot;</span>); <span class="comment">// Hello, world!</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;greeting&#125;, &#123;name&#125;!&quot;</span>, greeting=<span class="string">&quot;Hello&quot;</span>, name=<span class="string">&quot;world&quot;</span>); <span class="comment">// Hello, world!</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Hello, &quot;</span>) + <span class="string">&quot;world!&quot;</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, y); <span class="comment">// Hello, world!</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上代码将输出</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Hello, world!</span><br><span class="line">Hello, world!</span><br><span class="line">Hello, world!</span><br><span class="line">Hello, world!</span><br></pre></td></tr></table></figure>

<h3 id="1-3-使用-Cargo"><a href="#1-3-使用-Cargo" class="headerlink" title="1.3 使用 Cargo"></a>1.3 使用 Cargo</h3><p>为了方便之后的调试和学习，先介绍 Rust 内置的包管理和构建系统 <code>Cargo</code>，<a target="_blank" rel="noopener" href="https://crates.io/">crates.io</a> 是 Rust 的社区仓库。</p>
<ul>
<li><p>创建新项目：<em>cargo new <crate_name></em></p>
</li>
<li><p>编译：<em>cargo build</em></p>
</li>
<li><p>运行：<em>cargo run</em></p>
</li>
<li><p>更新项目依赖：<em>cargo update</em></p>
</li>
<li><p>执行测试：<em>cargo test</em></p>
</li>
<li><p>生成文档：<em>cargo doc</em></p>
</li>
<li><p>静态检查：<em>cargo check</em></p>
</li>
<li><p>新建二进制(Binary/Executable)项目</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cargo new tutu --bin</span><br><span class="line">$ <span class="built_in">cd</span> tutu &amp;&amp; tree</span><br><span class="line">├── Cargo.toml</span><br><span class="line">└── src</span><br><span class="line">    └── main.rs</span><br></pre></td></tr></table></figure>

<p>在 main.rs 中写入</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello, Cargo!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在项目目录下执行 <em>cargo run</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line"> tutu git:(master) ✗ cargo run</span><br><span class="line">   Compiling tutu v0.1.0 (/xxx/demo/tutu)</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) <span class="keyword">in</span> 0.49s</span><br><span class="line">     Running `target/debug/tutu`</span><br><span class="line">Hello, Cargo!</span><br></pre></td></tr></table></figure>

<ul>
<li>新建 Library 项目</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cargo new tutu --lib</span><br><span class="line">$ <span class="built_in">cd</span> tutu &amp;&amp; tree</span><br><span class="line">├── Cargo.toml</span><br><span class="line">└── src</span><br><span class="line">    └── lib.rs</span><br></pre></td></tr></table></figure>

<ul>
<li>Cargo.toml 是工程的描述文件，包含 Cargo 所需的所有元信息。</li>
<li>src 放置源代码。</li>
<li>main.rs / lib.rs 是入口文件。</li>
</ul>
<p>运行 <em>cargo run</em> 或 <em>cargo build</em>，可执行文件将生成在 target/debug/ 目录，运行 <em>cargo build –release</em>，可执行文件将生成在 target/release/ 。</p>
<h2 id="2-基本概念"><a href="#2-基本概念" class="headerlink" title="2 基本概念"></a>2 基本概念</h2><h3 id="2-1-注释"><a href="#2-1-注释" class="headerlink" title="2.1 注释"></a>2.1 注释</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/// 外部注释</span></span><br><span class="line"><span class="keyword">mod</span> test &#123;</span><br><span class="line">    <span class="comment">// 行注释</span></span><br><span class="line">    <span class="comment">/* 块注释 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">mod</span> test &#123;</span><br><span class="line">    <span class="comment">//! 包/模块级别的注释</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>///</code>用于 mod 块外部，<code>//!</code>用于书写包/模块级别的注释<br>注释支持 markdown 语法，使用 <em>cargo doc</em> 生成 HTML 文档。</p>
</blockquote>
<h3 id="2-2-变量"><a href="#2-2-变量" class="headerlink" title="2.2 变量"></a>2.2 变量</h3><ul>
<li>局部变量</li>
</ul>
<p>Rust 中变量默认是不可变的(immutable)，称为变量绑定(Variable bindings)，使用 <code>mut</code> 标志为可变(mutable)。</p>
<p>let 声明的变量是局部变量，声明时可以不初始化，使用前初始化即可。Rust是静态类型语言，编译时会检查类型，使用let声明变量时可以省略类型，编译时会推断一个合适的类型。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不可变</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">c</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">b</span>: <span class="type">bool</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">let</span> (x, y) = (<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">c = <span class="number">12345</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可变</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">z</span> = <span class="number">5</span>;</span><br><span class="line">z = <span class="number">6</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>全局变量</li>
</ul>
<p>rust 中可用 static 声明全局变量。用 static 声明的变量的生命周期是整个程序，从启动到退出，它占用的内存空间是固定的，不会在执行过程中回收。另外，static 声明语句，必须显式标明类型，不支持类型自动推导。全局变量在声明时必须初始化，且须是简单赋值，不能包括复杂的表达式、语句和函数调用。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 静态变量(不可变)</span></span><br><span class="line"><span class="keyword">static</span> N: <span class="type">i32</span> = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 静态变量(可变)</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">mut</span> N: <span class="type">i32</span> = <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>常量</li>
</ul>
<p>const 的生命周期也是整个程序，const 与 static 的最大区别在于，编译器并不一定会给 const 常量分配内存空间，在编译过程中，它很可能会被内联优化，类似于C语言的宏定义。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> N: <span class="type">i32</span> = <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-函数"><a href="#2-3-函数" class="headerlink" title="2.3 函数"></a>2.3 函数</h3><p>使用 <code>fn</code> 声明函数。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello, world!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参数需要指定类型</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">print_sum</span>(a: <span class="type">i8</span>, b: <span class="type">i8</span>) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;sum is: &#123;&#125;&quot;</span>, a + b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>默认返回值为空<code>()</code>，如果有返回值，需要使用<code>-&gt;</code>指定返回类型。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">plus_one</span>(a: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    a + <span class="number">1</span></span><br><span class="line">    <span class="comment">// 等价于 return a + 1，可省略为 a + 1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以利用元组(tuple)返回多个值</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">plus_one</span>(a: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> (<span class="type">i32</span>, <span class="type">i32</span>) &#123;</span><br><span class="line">    (a, &amp;a + <span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> (add_num, result) = <span class="title function_ invoke__">plus_one</span>(<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; + 1 = &#123;&#125;&quot;</span>, add_num, result); <span class="comment">// 10 + 1 = 11</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>函数指针也可以作为变量使用</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">b</span> = plus_one;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">c</span> = <span class="title function_ invoke__">b</span>(<span class="number">5</span>); <span class="comment">//6</span></span><br></pre></td></tr></table></figure>

<h3 id="2-4-基本数据类型"><a href="#2-4-基本数据类型" class="headerlink" title="2.4 基本数据类型"></a>2.4 基本数据类型</h3><ul>
<li>布尔值(bool)</li>
<li>字符(char)</li>
<li>有符号整型(i8, i16, i32, i64, i128)</li>
<li>无符号整型(u8, u16, u32, u64, u128)</li>
<li>指针大小的有符号/无符号整型(isize/usize，取决于计算机架构，32bit 的系统上，isize 等价于i32)</li>
<li>浮点数(f32, f64)</li>
<li>数组(arrays)，由相同类型元素构成，长度固定。</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]; <span class="comment">// a[0] = 1, a[1] = 2, a[2] = 3</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">b</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">c</span>: [int; <span class="number">3</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]; <span class="comment">// [类型; 数组长度]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">d</span>: [<span class="string">&quot;my value&quot;</span>; <span class="number">3</span>]; <span class="comment">//[&quot;my value&quot;, &quot;my value&quot;, &quot;my value&quot;];</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">e</span>: [<span class="type">i32</span>; <span class="number">0</span>] = []; <span class="comment">// 空数组</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, a); <span class="comment">//[1, 2, 3]</span></span><br></pre></td></tr></table></figure>

<p>数组(arrays)的长度是可不变的，动态/可变长数组可以使用 <code>Vec</code> (非基本数据类型)。</p>
<ul>
<li>元组(tuples)，由相同/不同类型元素构成，长度固定。</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = (<span class="number">1</span>, <span class="number">1.5</span>, <span class="literal">true</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&quot;Hello, world!&quot;</span>);</span><br><span class="line"><span class="comment">// a.0 = 1, a.1 = 1.5, a.2 = true, a.3 = &#x27;a&#x27;, a.4 = &quot;Hello, world!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">b</span>: (<span class="type">i32</span>, <span class="type">f64</span>) = (<span class="number">1</span>, <span class="number">1.5</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> (c, d) = b; <span class="comment">// c = 1, d = 1.5</span></span><br><span class="line"><span class="keyword">let</span> (e, _, _, _, f) = a; <span class="comment">//e = 1, f = &quot;Hello, world!&quot;, _ 作为占位符使用，表示忽略该位置的变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g</span> = (<span class="number">0</span>,); <span class="comment">// 只包含一个元素的元组</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">h</span> = (b, (<span class="number">2</span>, <span class="number">4</span>), <span class="number">5</span>); <span class="comment">//((1, 1.5), (2, 4), 5)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, a); <span class="comment">//(1, 1.5, true, &#x27;a&#x27;, &quot;Hello, world!&quot;)</span></span><br></pre></td></tr></table></figure>

<p>元组的长度也是不可变的，更新元组内元素的值时，需要与之前的值的类型相同。</p>
<ul>
<li>切片(slice)，指向一段内存的指针。</li>
</ul>
<p>切片并没有拷贝原有的数组，只是指向原有数组的一个连续部分，行为同数组。访问切片指向的数组/数据结构，可以使用<code>&amp;</code>操作符。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">a</span>: [<span class="type">i32</span>; <span class="number">4</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">b</span>: &amp;[<span class="type">i32</span>] = &amp;a; <span class="comment">// 全部</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">c</span> = &amp;a[<span class="number">0</span>..<span class="number">4</span>]; <span class="comment">// [0, 4)</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">d</span> = &amp;a[..]; <span class="comment">// 全部</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">e</span> = &amp;a[<span class="number">1</span>..<span class="number">3</span>]; <span class="comment">// [2, 3]</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">e</span> = &amp;a[<span class="number">1</span>..]; <span class="comment">// [2, 3, 4]</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">e</span> = &amp;a[..<span class="number">3</span>]; <span class="comment">// [1, 2, 3]</span></span><br></pre></td></tr></table></figure>

<ul>
<li>字符串(str)</li>
</ul>
<p>在 Rust 中，<code>str</code> 是不可变的静态分配的一个未知长度的UTF-8字节序列。<code>&amp;str</code> 是指向该字符串的切片。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = <span class="string">&quot;Hello, world!&quot;</span>; <span class="comment">//a: &amp;&#x27;static str</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">b</span>: &amp;<span class="type">str</span> = <span class="string">&quot;你好, 世界!&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>字符串切片<code>&amp;str</code>指向的字符串是静态分配的，在 Rust 中，有另一个堆分配的，可变长的字符串类型<code>String</code>(非基本数据类型)。通常由字符串切片<code>&amp;str</code>通过 <em>to_string()</em> 或 <em>String::from()</em> 方法转换得到。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s1</span> = <span class="string">&quot;Hello, world!&quot;</span>.<span class="title function_ invoke__">to_string</span>();</span><br><span class="line"><span class="keyword">let</span> <span class="variable">s2</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Hello, world!&quot;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>函数(functions)</li>
</ul>
<p>函数指针也是基本数据类型，可以赋值给其他的变量。</p>
<h3 id="2-5-操作符"><a href="#2-5-操作符" class="headerlink" title="2.5 操作符"></a>2.5 操作符</h3><ul>
<li>算数运算符</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+ - * / %</span><br><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">b</span> = a + <span class="number">1</span>; <span class="comment">//6</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">c</span> = a - <span class="number">1</span>; <span class="comment">//4</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">d</span> = a * <span class="number">2</span>; <span class="comment">//10</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">e</span> = a / <span class="number">2</span>; <span class="comment">// ⭐️ 2 not 2.5</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">f</span> = a % <span class="number">2</span>; <span class="comment">//1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g</span> = <span class="number">5.0</span> / <span class="number">2.0</span>; <span class="comment">//2.5</span></span><br></pre></td></tr></table></figure>

<ul>
<li>比较运算符</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">== = != &lt; &gt; &lt;= &gt;=</span><br><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">b</span> = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">c</span> = a == b; <span class="comment">//false</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">d</span> = a != b; <span class="comment">//true</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">e</span> = a &lt; b; <span class="comment">//true</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">f</span> = a &gt; b; <span class="comment">//false</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g</span> = a &lt;= a; <span class="comment">//true</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">h</span> = a &gt;= a; <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">i</span> = <span class="literal">true</span> &gt; <span class="literal">false</span>; <span class="comment">//true</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">j</span> = <span class="string">&#x27;a&#x27;</span> &gt; <span class="string">&#x27;A&#x27;</span>; <span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<ul>
<li>逻辑运算符</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> ! &amp;&amp; ||</span><br><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">b</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">c</span> = !a; <span class="comment">//false</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">d</span> = a &amp;&amp; b; <span class="comment">//false</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">e</span> = a || b; <span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<ul>
<li>位运算符</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&amp; | ^ &lt;&lt; &gt;&gt;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">b</span> = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">c</span> = a &amp; b; <span class="comment">//0  (01 &amp;&amp; 10 -&gt; 00)</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">d</span> = a | b; <span class="comment">//3  (01 || 10 -&gt; 11)</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">e</span> = a ^ b; <span class="comment">//3  (01 != 10 -&gt; 11)</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">f</span> = a &lt;&lt; b; <span class="comment">//4  (左移 -&gt; &#x27;01&#x27;+&#x27;00&#x27; -&gt; 100)</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g</span> = a &gt;&gt; a; <span class="comment">//0  (右移 -&gt; o̶1̶ -&gt; 0)</span></span><br></pre></td></tr></table></figure>

<ul>
<li>赋值运算符</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">a</span> = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">a += <span class="number">5</span>; <span class="comment">//2 + 5 = 7</span></span><br><span class="line">a -= <span class="number">2</span>; <span class="comment">//7 - 2 = 5</span></span><br><span class="line">a *= <span class="number">5</span>; <span class="comment">//5 * 5 = 25</span></span><br><span class="line">a /= <span class="number">2</span>; <span class="comment">//25 / 2 = 12 not 12.5</span></span><br><span class="line">a %= <span class="number">5</span>; <span class="comment">//12 % 5 = 2</span></span><br><span class="line"></span><br><span class="line">a &amp;= <span class="number">2</span>; <span class="comment">//10 &amp;&amp; 10 -&gt; 10 -&gt; 2</span></span><br><span class="line">a |= <span class="number">5</span>; <span class="comment">//010 || 101 -&gt; 111 -&gt; 7</span></span><br><span class="line">a ^= <span class="number">2</span>; <span class="comment">//111 != 010 -&gt; 101 -&gt; 5</span></span><br><span class="line">a &lt;&lt;= <span class="number">1</span>; <span class="comment">//&#x27;101&#x27;+&#x27;0&#x27; -&gt; 1010 -&gt; 10</span></span><br><span class="line">a &gt;&gt;= <span class="number">2</span>; <span class="comment">//101̶0̶ -&gt; 10 -&gt; 2</span></span><br></pre></td></tr></table></figure>

<ul>
<li>类型转换运算符: as</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = <span class="number">15</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">b</span> = (a <span class="keyword">as</span> <span class="type">f64</span>) / <span class="number">2.0</span>; <span class="comment">//7.5</span></span><br></pre></td></tr></table></figure>

<ul>
<li>借用(Borrowing)与解引用(Dereference)操作符</li>
</ul>
<p>Rust 引入了所有权(Ownership)的概念，所以在引用(Reference)的基础上衍生了借用(Borrowing)的概念，所有权概念不在这里展开。</p>
<p>简单而言，引用是为已存在变量创建一个别名；获取引用作为函数参数称为借用；解引用是与引用相反的动作，目的是返回引用指向的变量本身。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引用/借用： &amp; &amp;mut</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">len</span> = <span class="title function_ invoke__">calculate_length</span>(&amp;s1);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The length of &#x27;&#123;&#125;&#x27; is &#123;&#125;.&quot;</span>, s1, len); <span class="comment">// The length of &#x27;hello&#x27; is 5.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">calculate_length</span>(s: &amp;<span class="type">String</span>) <span class="punctuation">-&gt;</span> <span class="type">usize</span> &#123; <span class="comment">// 获取引用作为函数参数称为借用</span></span><br><span class="line">    s.<span class="title function_ invoke__">len</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 解引用： *</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// 获取v的第2个元素的可变引用，并通过解引用修改该元素的值。</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span> = &amp;<span class="keyword">mut</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">third</span>  = v.<span class="title function_ invoke__">get_mut</span>(<span class="number">2</span>).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        *third += <span class="number">50</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;v=&#123;:?&#125;&quot;</span>, v); <span class="comment">// v=[1, 2, 53, 4, 5]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://doc.rust-lang.org/stable/book/ch04-02-references-and-borrowing.html">References and Borrowing - 官方指南</a><br><a target="_blank" rel="noopener" href="https://doc.rust-lang.org/stable/book/ch04-01-what-is-ownership.html">What is ownership - 官方指南</a></p>
</blockquote>
<h3 id="2-6-控制流-Control-Flows"><a href="#2-6-控制流-Control-Flows" class="headerlink" title="2.6 控制流(Control Flows)"></a>2.6 控制流(Control Flows)</h3><ul>
<li>if - else if - else</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">team_size</span> = <span class="number">7</span>;</span><br><span class="line"><span class="keyword">if</span> team_size &lt; <span class="number">5</span> &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Small&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> team_size &lt; <span class="number">10</span> &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Medium&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Large&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 条件块中有返回值时，类型需要一致，可替代C语言的三目运算符</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">is_below_eighteen</span> = <span class="keyword">if</span> team_size &lt; <span class="number">18</span> &#123; <span class="literal">true</span> &#125; <span class="keyword">else</span> &#123; <span class="literal">false</span> &#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>match</li>
</ul>
<p>可替代C语言的<code>switch case</code>。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">tshirt_width</span> = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">tshirt_size</span> = <span class="keyword">match</span> tshirt_width &#123;</span><br><span class="line">    <span class="number">16</span> =&gt; <span class="string">&quot;S&quot;</span>, <span class="comment">// check 16</span></span><br><span class="line">    <span class="number">17</span> | <span class="number">18</span> =&gt; <span class="string">&quot;M&quot;</span>, <span class="comment">// check 17 and 18</span></span><br><span class="line">    <span class="number">19</span> ... <span class="number">21</span> =&gt; <span class="string">&quot;L&quot;</span>, <span class="comment">// check from 19 to 21 (19,20,21)</span></span><br><span class="line">    <span class="number">22</span> =&gt; <span class="string">&quot;XL&quot;</span>,</span><br><span class="line">    _ =&gt; <span class="string">&quot;Not Available&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, tshirt_size); <span class="comment">// L</span></span><br></pre></td></tr></table></figure>

<p><code>_</code>表示匹配剩下的任意情况。</p>
<ul>
<li>while</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">a</span> = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span> a &lt;= <span class="number">10</span> &#123;</span><br><span class="line">	<span class="built_in">println!</span>(<span class="string">&quot;Current value : &#123;&#125;&quot;</span>, a);</span><br><span class="line">	a += <span class="number">1</span>; <span class="comment">// Rust不支持++/--自增自减语法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>loop</li>
</ul>
<p>类似于C语言的<code>while(1)</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">a</span> = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">loop</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> a == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Skip Value : &#123;&#125;&quot;</span>, a);</span><br><span class="line">        a += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> a == <span class="number">2</span> &#123;</span><br><span class="line">	    <span class="built_in">println!</span>(<span class="string">&quot;Break At : &#123;&#125;&quot;</span>, a);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="built_in">println!</span>(<span class="string">&quot;Current Value : &#123;&#125;&quot;</span>, a);</span><br><span class="line">	a += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Skip Value : 0</span></span><br><span class="line"><span class="comment">// Current Value : 1</span></span><br><span class="line"><span class="comment">// Break At : 2</span></span><br></pre></td></tr></table></figure>

<ul>
<li>for</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="variable">a</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">10</span> &#123; <span class="comment">//(a = 0; a &lt;10; a++)</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Current value : &#123;&#125;&quot;</span>, a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="symbol">&#x27;outer_for</span>: <span class="keyword">for</span> <span class="variable">c1</span> <span class="keyword">in</span> <span class="number">1</span>..<span class="number">6</span> &#123; <span class="comment">//set label outer_for</span></span><br><span class="line">    <span class="symbol">&#x27;inner_for</span>: <span class="keyword">for</span> <span class="variable">c2</span> <span class="keyword">in</span> <span class="number">1</span>..<span class="number">6</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Current Value : [&#123;&#125;][&#123;&#125;]&quot;</span>, c1, c2);</span><br><span class="line">        <span class="keyword">if</span> c1 == <span class="number">2</span> &amp;&amp; c2 == <span class="number">2</span> &#123; <span class="keyword">break</span> <span class="symbol">&#x27;outer_for</span>; &#125; <span class="comment">// 结束外层循环</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">group</span> : [&amp;<span class="type">str</span>; <span class="number">4</span>] = [<span class="string">&quot;Mark&quot;</span>, <span class="string">&quot;Larry&quot;</span>, <span class="string">&quot;Bill&quot;</span>, <span class="string">&quot;Steve&quot;</span>];</span><br><span class="line"><span class="keyword">for</span> <span class="variable">person</span> <span class="keyword">in</span> group.<span class="title function_ invoke__">iter</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Current Person : &#123;&#125;&quot;</span>, person);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 for 表达式中的<code>break &#39;outer_for</code>，loop 和 while 也有相同的使用方式。</p>
<h2 id="3-其他数据类型"><a href="#3-其他数据类型" class="headerlink" title="3. 其他数据类型"></a>3. 其他数据类型</h2><h3 id="3-1-结构体-struct"><a href="#3-1-结构体-struct" class="headerlink" title="3.1 结构体(struct)"></a>3.1 结构体(struct)</h3><p>和元组(tuple)一样，结构体(struct)支持组合不同的数据类型，但不同于元组，结构体需要给每一部分数据命名以标志其含义。因而结构体比元组更加灵活，不依赖顺序来指定或访问实例中的值。</p>
<ul>
<li>定义结构体</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    username: <span class="type">String</span>,</span><br><span class="line">    email: <span class="type">String</span>,</span><br><span class="line">    sign_in_count: <span class="type">u64</span>,</span><br><span class="line">    active: <span class="type">bool</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>创建实例</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">user1</span> = User &#123;</span><br><span class="line">    email: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;someone@example.com&quot;</span>),</span><br><span class="line">    username: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;someusername123&quot;</span>),</span><br><span class="line">    active: <span class="literal">true</span>,</span><br><span class="line">    sign_in_count: <span class="number">1</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>修改某个字段的值</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">user1</span> = User &#123;</span><br><span class="line">    email: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;someone@example.com&quot;</span>),</span><br><span class="line">    username: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;someusername123&quot;</span>),</span><br><span class="line">    active: <span class="literal">true</span>,</span><br><span class="line">    sign_in_count: <span class="number">1</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">user1.email = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;anotheremail@example.com&quot;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>变量与字段名同名的简写语法</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">build_user</span>(email: <span class="type">String</span>, username: <span class="type">String</span>) <span class="punctuation">-&gt;</span> User &#123;</span><br><span class="line">    User &#123;</span><br><span class="line">        email,</span><br><span class="line">        username,</span><br><span class="line">        active: <span class="literal">true</span>,</span><br><span class="line">        sign_in_count: <span class="number">1</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>元组结构体(tuple structs)</li>
</ul>
<p>元组结构体有着结构体名称提供的含义，但没有具体的字段名。在参数个数较少时，无字段名称，仅靠下标也有很强的语义时，为每个字段命名就显得多余了。例如：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Color</span>(<span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>);</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>(<span class="type">i32</span>, <span class="type">i32</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">black</span> = <span class="title function_ invoke__">Color</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">origin</span> = <span class="title function_ invoke__">Point</span>(<span class="number">3</span>, <span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<p>VS</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    x: <span class="type">i32</span></span><br><span class="line">    y: <span class="type">i32</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">origin</span> = Point &#123;</span><br><span class="line">    x: <span class="number">3</span></span><br><span class="line">    y: <span class="number">4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-枚举-enum"><a href="#3-2-枚举-enum" class="headerlink" title="3.2 枚举(enum)"></a>3.2 枚举(enum)</h3><ul>
<li>定义枚举</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">IpAddrKind</span> &#123;</span><br><span class="line">    V4,</span><br><span class="line">    V6,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用枚举值</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">four</span> = IpAddrKind::V4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">route</span>(ip_type: IpAddrKind) &#123; &#125;</span><br><span class="line"><span class="title function_ invoke__">route</span>(four);</span><br><span class="line"><span class="title function_ invoke__">route</span>(IpAddrKind::V6);</span><br></pre></td></tr></table></figure>

<ul>
<li>枚举成员关联数据</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">IpAddr</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">V4</span>(<span class="type">u8</span>, <span class="type">u8</span>, <span class="type">u8</span>, <span class="type">u8</span>),</span><br><span class="line">    <span class="title function_ invoke__">V6</span>(<span class="type">String</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">home</span> = IpAddr::<span class="title function_ invoke__">V4</span>(<span class="number">127</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">loopback</span> = IpAddr::<span class="title function_ invoke__">V6</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;::1&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>更复杂的例子</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">    Quit, <span class="comment">//  不关联数据</span></span><br><span class="line">    Move &#123; x: <span class="type">i32</span>, y: <span class="type">i32</span> &#125;, <span class="comment">// 匿名结构体</span></span><br><span class="line">    <span class="title function_ invoke__">Write</span>(<span class="type">String</span>),</span><br><span class="line">    <span class="title function_ invoke__">ChangeColor</span>(<span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>match 控制流</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Coin</span> &#123;</span><br><span class="line">    Penny,</span><br><span class="line">    Nickel,</span><br><span class="line">    Dime,</span><br><span class="line">    Quarter,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">value_in_cents</span>(coin: Coin) <span class="punctuation">-&gt;</span> <span class="type">u32</span> &#123;</span><br><span class="line">    <span class="keyword">match</span> coin &#123;</span><br><span class="line">        Coin::Penny =&gt; &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Lucky penny!&quot;</span>);</span><br><span class="line">            <span class="number">1</span></span><br><span class="line">        &#125;,</span><br><span class="line">        Coin::Nickel =&gt; <span class="number">5</span>,</span><br><span class="line">        Coin::Dime =&gt; <span class="number">10</span>,</span><br><span class="line">        Coin::Quarter =&gt; <span class="number">25</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Option</li>
</ul>
<p>Option是标准库中定义的一个非常重要的枚举类型。Option 类型应用广泛因为它编码了一个非常普遍的场景，即一个值要么有值要么没值。对Rust而言，变量在使用前必须要赋予一个有效的值，所以不存在空值(Null)，因此在使用任意类型的变量时，编译器确保它总是有一个有效的值，可以自信使用而无需做任何检查。如果一个值可能为空，需要显示地使用<code>Option&lt;T&gt;</code>来表示。</p>
<p>Option 的定义如下：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">enum</span> <span class="title class_">Option</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(T),</span><br><span class="line">    <span class="literal">None</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Option&lt;T&gt;</code>包含2个枚举项：</p>
<ol>
<li>None，表明失败或没有值</li>
<li>Some(value)，元组结构体，封装了一个 T 类型的值 value</li>
</ol>
<p>得益于<code>Option</code>，Rust 不允许一个可能存在空值的值，像一个正常的有效值那样工作，在编译时就能够检查出来。Rust显得更加安全，不用担心出现其他语言运行时才会出现的空指针异常的bug。例如：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span>: <span class="type">i8</span> = <span class="number">5</span>; <span class="comment">// Rust 没有空值(Null)，因此 i8只能被赋予一个有效值。</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">y</span>: <span class="type">Option</span>&lt;<span class="type">i8</span>&gt; = <span class="title function_ invoke__">Some</span>(<span class="number">5</span>); <span class="comment">// y 可能为空，需要显示地表示为枚举类型 Option</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">sum</span> = x + y;</span><br></pre></td></tr></table></figure>

<p>尝试将不可能出现无效值的 <code>x:i8</code> 与可能出现无效值的<code>y: Option&lt;i8&gt;</code> 相加时，编译器会报错：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">error[E0277]: the trait bound `i8: std::ops::Add&lt;std::option::Option&lt;i8&gt;&gt;` is</span><br><span class="line">not satisfied</span><br><span class="line"> --&gt;</span><br><span class="line">  |</span><br><span class="line">5 |     <span class="built_in">let</span> <span class="built_in">sum</span> = x + y;</span><br><span class="line">  |                 ^ no implementation <span class="keyword">for</span> `i8 + std::option::Option&lt;i8&gt;`</span><br><span class="line">  |</span><br></pre></td></tr></table></figure>

<p>总结一下，如果一个值可能为空，必须使用枚举类型<code>Option&lt;T&gt;</code>，否则必须赋予有效值。而为了使用<code>Option&lt;T&gt;</code>，需要编写处理每个成员的代码，当<em>T</em> 为有效值时，才能够从 <em>Some(T)</em> 中取出 <em>T</em> 的值来使用，如果 <em>T</em> 为无效值，可以进行其他的处理，通常使用 <em>match</em> 来处理这种情况。</p>
<p>例如，当y为有效值时，返回x和y的和；为空值时，返回x。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">plus</span>(x: <span class="type">i8</span>, y: <span class="type">Option</span>&lt;<span class="type">i8</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">i8</span> &#123;</span><br><span class="line">    <span class="keyword">match</span> y &#123;</span><br><span class="line">        <span class="literal">None</span> =&gt; x,</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(i) =&gt; x + i,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y1</span>: <span class="type">Option</span>&lt;<span class="type">i8</span>&gt; = <span class="title function_ invoke__">Some</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y2</span>: <span class="type">Option</span>&lt;<span class="type">i8</span>&gt; = <span class="literal">None</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> <span class="variable">z1</span> = <span class="title function_ invoke__">plus</span>(<span class="number">10</span>, y1);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">z2</span> = <span class="title function_ invoke__">plus</span>(<span class="number">10</span>, y2);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;z1=&#123;&#125;, z2=&#123;&#125;&quot;</span>, z1, z2); <span class="comment">// z1=15, z2=10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>if let 控制流</li>
</ul>
<p><em>match</em> 还有一种简单场景，可以简写为 <code>if let</code>。如下，y有值时，打印和，y无值时，啥事也不做。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">plus</span>(x: <span class="type">i8</span>, y: <span class="type">Option</span>&lt;<span class="type">i8</span>&gt;) &#123;</span><br><span class="line">    <span class="keyword">match</span> y &#123;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(i) =&gt; &#123; <span class="built_in">println!</span>(<span class="string">&quot;x + y = &#123;&#125;&quot;</span>, x + i) &#125;,</span><br><span class="line">        <span class="literal">None</span> =&gt; &#123;&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y1</span>: <span class="type">Option</span>&lt;<span class="type">i8</span>&gt; = <span class="title function_ invoke__">Some</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y2</span>: <span class="type">Option</span>&lt;<span class="type">i8</span>&gt; = <span class="literal">None</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_ invoke__">plus</span>(<span class="number">10</span>, y1); <span class="comment">// x + y = 15</span></span><br><span class="line">    <span class="title function_ invoke__">plus</span>(<span class="number">10</span>, y2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>简写为 <code>if let</code>，则是</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">plus</span>(x: <span class="type">i8</span>, y: <span class="type">Option</span>&lt;<span class="type">i8</span>&gt;) &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(i) = y &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;x + y = &#123;&#125;&quot;</span>, x + i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果只使用 <code>if</code> 呢？</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">plus</span>(x: <span class="type">i8</span>, y: <span class="type">Option</span>&lt;<span class="type">i8</span>&gt;) &#123;</span><br><span class="line">    <span class="keyword">if</span> y.<span class="title function_ invoke__">is_some</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">i</span> = y.<span class="title function_ invoke__">unwrap</span>(); <span class="comment">// 获得 Some 中的 T 值。</span></span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;x + y = &#123;&#125;&quot;</span>, x + i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>if let</code> 语句也可以包含 <code>else</code>。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">plus</span>(x: <span class="type">i8</span>, y: <span class="type">Option</span>&lt;<span class="type">i8</span>&gt;) &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(i) = y &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;x + y = &#123;&#125;&quot;</span>, x + i);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;y is None&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">plus</span>(x: <span class="type">i8</span>, y: <span class="type">Option</span>&lt;<span class="type">i8</span>&gt;) &#123;</span><br><span class="line">    <span class="keyword">match</span> y &#123;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(i) =&gt; &#123; <span class="built_in">println!</span>(<span class="string">&quot;x + y = &#123;&#125;&quot;</span>, x + i) &#125;,</span><br><span class="line">        <span class="literal">None</span> =&gt; &#123; <span class="built_in">println!</span>(<span class="string">&quot;y is None&quot;</span>) &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-实现方法和接口-impl-amp-traits"><a href="#3-3-实现方法和接口-impl-amp-traits" class="headerlink" title="3.3 实现方法和接口(impl &amp; traits)"></a>3.3 实现方法和接口(impl &amp; traits)</h3><ul>
<li>实现方法(impl)</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    width: <span class="type">u32</span>,</span><br><span class="line">    height: <span class="type">u32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">area</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">u32</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.width * <span class="keyword">self</span>.height</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">can_hold</span>(&amp;<span class="keyword">self</span>, other: &amp;Rectangle) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.width &gt; other.width &amp;&amp; <span class="keyword">self</span>.height &gt; other.height</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">rect1</span> = Rectangle &#123; width: <span class="number">30</span>, height: <span class="number">50</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(</span><br><span class="line">        <span class="string">&quot;The area of the rectangle is &#123;&#125; square pixels.&quot;</span>,</span><br><span class="line">        rect1.<span class="title function_ invoke__">area</span>()</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>关联函数(associated functions)</li>
</ul>
<p>关联函数不以<code>self</code>作为参数，关联函数之所以成为函数而不是方法，是因为关联函数并不作用于一个结构体的实例。我们之前创建字符串类型时，使用过的 <em>String::from</em> 就是关联函数。关联函数经常被用作返回一个结构体新实例的构造函数。例如我们可以提供一个关联函数，它接受一个维度参数并且同时作为宽和高，这样可以更轻松的创建一个正方形 Rectangle 而不必指定两次同样的值：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">square</span>(size: <span class="type">u32</span>) <span class="punctuation">-&gt;</span> Rectangle &#123;</span><br><span class="line">        Rectangle &#123; width: size, height: size &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">rect2</span> = Rectangle::<span class="title function_ invoke__">square</span>(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>实现接口(traits)</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">trait</span> <span class="title class_">Summary</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">summarize</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Summary</span> <span class="keyword">for</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">summarize</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#123;width=&#123;&#125;, height=&#123;&#125;&#125;&#125;&quot;</span>, <span class="keyword">self</span>.width, <span class="keyword">self</span>.height)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接口也支持继承</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">full_name</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Employee</span> : Person &#123; <span class="comment">//Employee inherit from person trait</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">job_title</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Expat</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">salary</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">f32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">ExpatEmployee</span> : Employee + Expat &#123; <span class="comment">// 多继承，同时继承 Employee 和 Expat</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">additional_tax</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">f64</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-泛型-Generics"><a href="#3-3-泛型-Generics" class="headerlink" title="3.3 泛型(Generics)"></a>3.3 泛型(Generics)</h3><p>当我们实现一个函数或者数据结构时，往往希望参数可以支持不同的类型，泛型可以解决这个问题。声明参数类型时，换成大写的字母，例如字母 T，同时使用<code>&lt;T&gt;</code>告诉编译器 <em>T</em> 是泛型。</p>
<ul>
<li>函数中使用泛型</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">largest</span>&lt;T&gt;(list: &amp;[T]) <span class="punctuation">-&gt;</span> T &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">largest</span> = list[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> &amp;item <span class="keyword">in</span> list.<span class="title function_ invoke__">iter</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> item &gt; largest &#123;</span><br><span class="line">            largest = item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    largest</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">number_list</span> = <span class="built_in">vec!</span>[<span class="number">34</span>, <span class="number">50</span>, <span class="number">25</span>, <span class="number">100</span>, <span class="number">65</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">largest</span>(&amp;number_list);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The largest number is &#123;&#125;&quot;</span>, result);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">char_list</span> = <span class="built_in">vec!</span>[<span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;q&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">largest</span>(&amp;char_list);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The largest char is &#123;&#125;&quot;</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>结构体使用泛型</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&lt;T&gt; &#123;</span><br><span class="line">    x: T,</span><br><span class="line">    y: T,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">integer</span> = Point &#123; x: <span class="number">5</span>, y: <span class="number">10</span> &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">float</span> = Point &#123; x: <span class="number">1.0</span>, y: <span class="number">4.0</span> &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>枚举使用泛型</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Option</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(T),</span><br><span class="line">    <span class="literal">None</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Result</span>&lt;T, E&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(T),</span><br><span class="line">    <span class="title function_ invoke__">Err</span>(E),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Result 枚举有两个泛型类型，T 和 E。Result 有两个成员：Ok，它存放一个类型 T 的值，而 Err 则存放一个类型 E 的值。这个定义使得 Result 枚举能很方便的表达任何可能成功（返回 T 类型的值）也可能失败（返回 E 类型的值）的操作。回忆一下示例 9-3 中打开一个文件的场景：当文件被成功打开 T 被放入了 <em>std::fs::File</em> 类型而当打开文件出现问题时 E 被放入了 <em>std::io::Error</em> 类型。</p>
<ul>
<li>方法中使用泛型</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&lt;T&gt; &#123;</span><br><span class="line">    x: T,</span><br><span class="line">    y: T,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; Point&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">x</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;T &#123;</span><br><span class="line">        &amp;<span class="keyword">self</span>.x</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p</span> = Point &#123; x: <span class="number">5</span>, y: <span class="number">10</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;p.x = &#123;&#125;&quot;</span>, p.<span class="title function_ invoke__">x</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-4-常见集合-Vec"><a href="#3-4-常见集合-Vec" class="headerlink" title="3.4 常见集合 Vec"></a>3.4 常见集合 Vec</h3><ul>
<li>新建</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">v</span>: <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();  <span class="comment">// 空集合</span></span><br><span class="line"><span class="comment">// let v = vec![1, 2, 3];  // 含初始值的集合，vec!是为方便初始化Vec提供的宏。</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;第三个元素 &#123;&#125;&quot;</span>, &amp;v[<span class="number">2</span>]); <span class="comment">// 3</span></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;第100个元素 &#123;&#125;&quot;</span>, &amp;v[<span class="number">100</span>]); <span class="comment">// panic error</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">assert_eq!</span>(v.<span class="title function_ invoke__">get</span>(<span class="number">2</span>), <span class="title function_ invoke__">Some</span>(&amp;<span class="number">3</span>));</span><br><span class="line"><span class="built_in">assert_eq!</span>(v.<span class="title function_ invoke__">get</span>(<span class="number">100</span>), <span class="literal">None</span>);</span><br></pre></td></tr></table></figure>

<p>v.get(2) 和 &amp;v[2] 都能获取到 Vec 的值，区别在于 &amp;v[2] 返回的是该元素的引用，引用一个不存在的位置，会引发错误。v.get(2) 返回的是枚举类型 <code>Option&lt;&amp;T&gt;</code>。v.get(2) 返回的是 Some(&amp;3)，v.get(100) 返回的是 <em>None</em>。</p>
<ul>
<li>更新</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">v</span>: <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">v.<span class="title function_ invoke__">push</span>(<span class="number">5</span>);</span><br><span class="line">v.<span class="title function_ invoke__">push</span>(<span class="number">6</span>);</span><br><span class="line">v.<span class="title function_ invoke__">push</span>(<span class="number">7</span>);</span><br><span class="line">v.<span class="title function_ invoke__">push</span>(<span class="number">8</span>);</span><br><span class="line">v.<span class="title function_ invoke__">pop</span>() <span class="comment">//删除最后一个元素</span></span><br></pre></td></tr></table></figure>

<ul>
<li>遍历</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">100</span>, <span class="number">32</span>, <span class="number">57</span>];</span><br><span class="line"><span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> &amp;v &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v2</span> = <span class="built_in">vec!</span>[<span class="number">100</span>, <span class="number">32</span>, <span class="number">57</span>];</span><br><span class="line"><span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> &amp;<span class="keyword">mut</span> v2 &#123;</span><br><span class="line">    *i += <span class="number">50</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>if let 控制流</li>
</ul>
<p>如果我们想修改<code>Vec</code>中第2个元素的值呢？可以这么写：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">third</span>  = v.<span class="title function_ invoke__">get_mut</span>(<span class="number">2</span>).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        *third += <span class="number">50</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;v=&#123;:?&#125;&quot;</span>, v); <span class="comment">// v=[1, 2, 53, 4, 5]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为 v.get_mut() 的返回值是<code>Option&lt;T&gt;</code>枚举类型，那么可以使用<code>if let</code>来简化代码。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(third) = v.<span class="title function_ invoke__">get_mut</span>(<span class="number">2</span>) &#123;</span><br><span class="line">        *third += <span class="number">50</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;v=&#123;:?&#125;&quot;</span>, v); <span class="comment">// v=[1, 2, 53, 4, 5]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>while let 控制流</li>
</ul>
<p><code>if let</code>可以用于单个元素的场景，<code>while let</code>就适用于遍历的场景了。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">stack</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">let</span> <span class="variable">Some</span>(top) = stack.<span class="title function_ invoke__">pop</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, top); <span class="comment">// 依次打印 5 4 3 2 1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>更多用法参考：<a target="_blank" rel="noopener" href="https://doc.rust-lang.org/std/vec/struct.Vec.html">Vec - 官方文档</a></p>
</blockquote>
<h3 id="3-5-常见集合-String"><a href="#3-5-常见集合-String" class="headerlink" title="3.5 常见集合 String"></a>3.5 常见集合 String</h3><p>Rust 的核心语言中只有一种字符串类型：<code>str</code>，字符串切片，它通常以被借用的形式出现，<code>&amp;str</code>。这里提到的字符串，是字节的集合，外加一些常用方法实现。因为是集合，增持增删改，长度也可变。</p>
<ul>
<li>新建</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s1</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line"><span class="keyword">let</span> <span class="variable">s2</span> = <span class="string">&quot;initial contents&quot;</span>.<span class="title function_ invoke__">to_string</span>();</span><br><span class="line"><span class="keyword">let</span> <span class="variable">s3</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br></pre></td></tr></table></figure>

<ul>
<li>更新</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line">s.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot;bar&quot;</span>); <span class="comment">// 附加字符串</span></span><br><span class="line">s.<span class="title function_ invoke__">push</span>(<span class="string">&#x27;!&#x27;</span>) <span class="comment">// 附加单字符</span></span><br><span class="line"><span class="built_in">assert_eq!</span>(s.<span class="title function_ invoke__">remove</span>(<span class="number">0</span>), <span class="string">&#x27;f&#x27;</span>); <span class="comment">// 删除某个位置的字符</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Hello, &quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">s2</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;world!&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">s3</span> = s1 + &amp;s2;</span><br></pre></td></tr></table></figure>

<ul>
<li>format</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;tic&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">s2</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;tac&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">s3</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;toe&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s</span> = <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125;-&#123;&#125;-&#123;&#125;&quot;</span>, s1, s2, s3);</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, s); <span class="comment">// tic-tac-toe</span></span><br></pre></td></tr></table></figure>

<ul>
<li>索引</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">v</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">Some</span>(<span class="string">&#x27;h&#x27;</span>), v.<span class="title function_ invoke__">chars</span>().<span class="title function_ invoke__">nth</span>(<span class="number">0</span>));</span><br></pre></td></tr></table></figure>

<ul>
<li>遍历</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">v</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> <span class="variable">c</span> <span class="keyword">in</span> v.<span class="title function_ invoke__">chars</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在Rust内部，String 是一个 <code>Vec&lt;u8&gt;</code> 的封装，但是有些字符可能会占用超过2个字符，所以<code>String</code>不支持直接索引，如果需要索引需要使用 <em>chars()</em> 转换后再使用。</p>
<blockquote>
<p>参考 <a target="_blank" rel="noopener" href="https://doc.rust-lang.org/std/string/struct.String.html">String - 官方文档</a></p>
</blockquote>
<h3 id="3-6-常见集合-HashMap"><a href="#3-6-常见集合-HashMap" class="headerlink" title="3.6 常见集合 HashMap"></a>3.6 常见集合 HashMap</h3><ul>
<li>新建</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">scores</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>), <span class="number">10</span>);</span><br><span class="line">scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Yellow&quot;</span>), <span class="number">50</span>);</span><br></pre></td></tr></table></figure>

<p>这里使用了<code>use</code>引入了<code>HashMap</code>结构体。</p>
<ul>
<li>访问</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">scores</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>), <span class="number">10</span>);</span><br><span class="line">scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Yellow&quot;</span>), <span class="number">50</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">team_name</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">score</span> = scores.<span class="title function_ invoke__">get</span>(&amp;team_name);</span><br></pre></td></tr></table></figure>

<ul>
<li>更新</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">scores</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>), <span class="number">10</span>); <span class="comment">// 10</span></span><br><span class="line">scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>), <span class="number">25</span>); <span class="comment">// 25</span></span><br><span class="line"><span class="comment">// Blue 存在则不更新，不存在则更新，因此scores[&#x27;Blue&#x27;] 仍为 25</span></span><br><span class="line">scores.<span class="title function_ invoke__">entry</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>)).<span class="title function_ invoke__">or_insert</span>(<span class="number">50</span>); </span><br></pre></td></tr></table></figure>

<blockquote>
<p>参考 <a target="_blank" rel="noopener" href="https://doc.rust-lang.org/std/collections/struct.HashMap.html">HashMap - 官方文档</a></p>
</blockquote>
<h2 id="4-错误处理"><a href="#4-错误处理" class="headerlink" title="4 错误处理"></a>4 错误处理</h2><h3 id="4-1-不可恢复错误-panic"><a href="#4-1-不可恢复错误-panic" class="headerlink" title="4.1 不可恢复错误 panic!"></a>4.1 不可恢复错误 panic!</h3><p>Rust 有 panic!宏。当执行这个宏时，程序会打印出一个错误信息，展开并清理栈数据，然后接着退出。出现这种场景，一般是出现了一些不知如何处理的场景。</p>
<ul>
<li>直接调用</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">panic!</span>(<span class="string">&quot;crash and burn&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行 <em>cargo run</em> 将打印出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line">Compiling tutu v0.1.0 (/xxx/demo/tutu)</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) <span class="keyword">in</span> 0.28s</span><br><span class="line">     Running `target/debug/tutu`</span><br><span class="line">thread <span class="string">&#x27;main&#x27;</span> panicked at <span class="string">&#x27;crash and burn&#x27;</span>, src/main.rs:2:5</span><br><span class="line">note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace.</span><br></pre></td></tr></table></figure>

<p>最后2行包含了 <code>panic!</code>导致的报错信息，第1行是源码中 <code>panic!</code> 出现的位置 src/main.rs:2:5</p>
<ul>
<li>代码bug引起的错误</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    v[<span class="number">99</span>]; <span class="comment">// 越界</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>和之前一样，<em>cargo run</em> 的报错信息只有2行，缺少函数的调用栈，为了便于定位问题，可以设置 <em>RUST_BACKTRACE</em> 环境变量来获得更多的调用栈信息，Rust 中称之为<code>backtrace</code>。通过<code>backtrace</code>，可以看到执行到目前位置所有被调用的函数的列表。</p>
<p>例如执行 <em>RUST_BACKTRACE=1 cargo run</em>，这种方式的好处在于，环境变量只作用于当前命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ RUST_BACKTRACE=1 cargo run</span><br><span class="line">Finished dev [unoptimized + debuginfo] target(s) <span class="keyword">in</span> 0.00s</span><br><span class="line">     Running `target/debug/tutu`</span><br><span class="line">thread <span class="string">&#x27;main&#x27;</span> panicked at <span class="string">&#x27;index out of bounds: the len is 3 but the index is 99&#x27;</span>, /rustc/xxx/src/libcore/slice/mod.rs:2717:10</span><br><span class="line">stack backtrace:</span><br><span class="line">   0: backtrace::backtrace::libunwind::trace</span><br><span class="line">             at /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.37/src/backtrace/libunwind.rs:88</span><br><span class="line">  ...</span><br><span class="line">  17: &lt;alloc::vec::Vec&lt;T&gt; as core::ops::index::Index&lt;I&gt;&gt;::index</span><br><span class="line">             at /rustc/xxx/src/liballoc/vec.rs:1796</span><br><span class="line">  18: tutu::main</span><br><span class="line">             at src/main.rs:4</span><br><span class="line">note: Some details are omitted, run with `RUST_BACKTRACE=full` <span class="keyword">for</span> a verbose backtrace.</span><br></pre></td></tr></table></figure>

<p>第一行的报错信息，说明了错误的原因，长度越界。紧接着打印出了函数调用栈，src/main.rs:4 -&gt; liballoc/vec.rs:1796 -&gt; …</p>
<p>在windows下，可以执行 <em>set RUST_BACKTRACE=1 &amp;&amp; cargo run</em>。</p>
<ul>
<li>release</li>
</ul>
<p>当出现 panic 时，程序默认会开始 展开（unwinding），这意味着 Rust 会回溯栈并清理它遇到的每一个函数的数据，不过这个回溯并清理的过程有很多工作。另一种选择是直接 终止（abort），这会不清理数据就退出程序。那么程序所使用的内存需要由操作系统来清理。</p>
<p>release模式下，希望程序越小越好，可以在<code>Cargo.toml</code>中设置 panic 为 abort。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[profile.release]</span></span><br><span class="line"><span class="attr">panic</span> = <span class="string">&quot;abort&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-可恢复错误-Result"><a href="#4-2-可恢复错误-Result" class="headerlink" title="4.2 可恢复错误 Result"></a>4.2 可恢复错误 Result</h3><ul>
<li>处理 Result</li>
</ul>
<p>有些错误，希望能够捕获并且做相应的处理，Rust 提供了 <code>Result</code> 机制来处理可恢复错误，类似于其他语言中的<code>try catch</code>。</p>
<p>这是 <code>Result&lt;T, E&gt;</code>的定义</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Result</span>&lt;T, E&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(T),</span><br><span class="line">    <span class="title function_ invoke__">Err</span>(E),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有些函数会返回<code>Result</code>，那怎么知道一个函数的返回对象是不是<code>Result</code>呢？很简单！</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span>: <span class="type">u32</span> = File::<span class="title function_ invoke__">create</span>(<span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当我们编译上面的代码时，将会报错。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">= note: expected <span class="built_in">type</span> `u32`</span><br><span class="line">            found <span class="built_in">type</span> `std::result::Result&lt;std::fs::File, std::io::Error&gt;`</span><br></pre></td></tr></table></figure>

<p>从报错信息可以看出，<em>File::create</em> 返回的是一个<code>Result&lt;fs::File. io::Error&gt;</code>对象，如果没有异常，我们可以从<code>Result::Ok&lt;T&gt;</code>获取到文件句柄。</p>
<p>下面是一个完整的示例，创建 hello.txt 文件，并尝试写入 “Hello, world!”。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"><span class="keyword">use</span> std::io::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = File::<span class="title function_ invoke__">create</span>(<span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">file</span> = <span class="keyword">match</span> f &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(file) =&gt; file,</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(error) =&gt; &#123;</span><br><span class="line">            <span class="built_in">panic!</span>(<span class="string">&quot;Problem create the file: &#123;:?&#125;&quot;</span>, error)</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">match</span> file.<span class="title function_ invoke__">write_all</span>(<span class="string">b&quot;Hello, world!&quot;</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(()) =&gt; &#123;&#125;,</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(error) =&gt; &#123;</span><br><span class="line">            <span class="built_in">panic!</span>(<span class="string">&quot;Failed to write: &#123;:?&#125;&quot;</span>, error)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果执行成功，可以看到在工程根目录下，多出了 hello.txt 文件。</p>
<ul>
<li>unwrap 和 expect</li>
</ul>
<p><code>Result</code> 的处理有时太过于繁琐，Rust 提供了一种简洁的处理方式 <em>unwrap</em> 。即，如果成功，直接返回 <code>Result::Ok&lt;T&gt;</code> 中的值，如果失败，则直接调用 <code>!panic</code>，程序结束。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">f</span> = File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>).<span class="title function_ invoke__">unwrap</span>(); <span class="comment">// 若成功，f则被赋值为文件句柄，失败则结束。</span></span><br></pre></td></tr></table></figure>

<p><em>expect</em> 是更人性化的处理方式，允许在调用<code>!panic</code>时，返回自定义的提示信息，对调试很有帮助。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">f</span> = File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>).<span class="title function_ invoke__">expect</span>(<span class="string">&quot;Failed to open hello.txt&quot;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>返回 Result</li>
</ul>
<p>我们可以实现类似于 <em>File::open</em> 这样的函数，让调用者能够自主绝对如何处理成功/失败的场景。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::io;</span><br><span class="line"><span class="keyword">use</span> std::io::Read;</span><br><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">read_username_from_file</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">String</span>, io::Error&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">f</span> = <span class="keyword">match</span> f &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(file) =&gt; file,</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(e),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">match</span> f.<span class="title function_ invoke__">read_to_string</span>(&amp;<span class="keyword">mut</span> s) &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(_) =&gt; <span class="title function_ invoke__">Ok</span>(s),</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="title function_ invoke__">Err</span>(e),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的函数如果成功，则返回 hello.txt 的文本字符串，失败，则返回 <code>io::Error</code>。</p>
<ul>
<li>更简单的实现方式</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::io;</span><br><span class="line"><span class="keyword">use</span> std::io::Read;</span><br><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">read_username_from_file</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">String</span>, io::Error&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">f</span> = File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>)?;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    f.<span class="title function_ invoke__">read_to_string</span>(&amp;<span class="keyword">mut</span> s)?;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种写法使用了<code>?</code>运算符向调用者返回错误。</p>
<p>作用是：如果 <code>Result</code> 的值是 Ok，则该表达式返回 Ok 中的值且程序继续执行。如果值是  Error ，则将 Error 的值作为整个函数的返回值，好像使用了 <code>return</code> 关键字一样。这样写，逻辑更为清晰。</p>
<h2 id="5-包、crate和模块"><a href="#5-包、crate和模块" class="headerlink" title="5 包、crate和模块"></a>5 包、crate和模块</h2><h3 id="5-1-包和-crate"><a href="#5-1-包和-crate" class="headerlink" title="5.1 包和 crate"></a>5.1 包和 crate</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── Cargo.lock</span><br><span class="line">├── Cargo.toml</span><br><span class="line">├── benches</span><br><span class="line">│   └── large-input.rs</span><br><span class="line">├── examples</span><br><span class="line">│   └── simple.rs</span><br><span class="line">├── src</span><br><span class="line">│   ├── bin</span><br><span class="line">│   │   └── another_executable.rs</span><br><span class="line">│   ├── lib.rs</span><br><span class="line">│   └── main.rs</span><br><span class="line">└── tests</span><br><span class="line">    └── some-integration-tests.rs</span><br></pre></td></tr></table></figure>

<p>一个 Cargo 项目即一个包(Package)，一个包至少包含一个crate；可以包含零个或多个二进制crate（binary crate），但只能包含一个库crate(library crate)。 src/main.rs 是与包名同名的二进制 crate 的根，其他的二进制 crate 的根放置在 src/bin 目录下； src/lib.rs 是与包名同名的库 crate 的根。</p>
<h3 id="5-2-模块"><a href="#5-2-模块" class="headerlink" title="5.2 模块"></a>5.2 模块</h3><p>模块 让我们可以将一个 crate 中的代码进行分组，以提高可读性与重用性。即项是可以被外部代码使用的（public），还是作为一个内部实现的内容，不能被外部代码使用（private）。</p>
<ul>
<li>声明模块</li>
</ul>
<p>Rust中使用mod来声明模块，模块允许嵌套，可以使用模块名作为路径使用，例如：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main.rs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">mod</span> math &#123;</span><br><span class="line">    <span class="keyword">mod</span> basic &#123;</span><br><span class="line">        <span class="keyword">fn</span> <span class="title function_">plus</span>(x: <span class="type">i32</span>, y: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123; x + y&#125;</span><br><span class="line">        <span class="keyword">fn</span> <span class="title function_">mul</span>(x: <span class="type">i32</span>, y: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123; x * y&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;2 + 3 = &#123;&#125;&quot;</span>, math::basic::<span class="title function_ invoke__">plus</span>(<span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;2 * 3 = &#123;&#125;&quot;</span>, math::basic::<span class="title function_ invoke__">mul</span>(<span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>引入作用域</li>
</ul>
<p>使用<code>use</code>可以将路径引入作用域。</p>
<p>我们在 src/lib.rs 中声明一个模块，在 src/main.rs 中调用。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/lib.rs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> greeting &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">hello</span>(name: &amp;<span class="type">str</span>) &#123; <span class="built_in">println!</span>(<span class="string">&quot;Hello, &#123;&#125;&quot;</span>, &amp;name) &#125; <span class="comment">// pub 才能外部可见</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main.rs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> tutu;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    tutu::greeting::<span class="title function_ invoke__">hello</span>(<span class="string">&quot;Jack&quot;</span>); <span class="comment">// Hello, Jack</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>路径的长度可以自由定义，也可以写成</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main.rs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> tutu::greeting;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    greeting::<span class="title function_ invoke__">hello</span>(<span class="string">&quot;Jack&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>src/main.rs 和 src/lib.rs 属于不同的 crate ，所以引入作用域时，需要带上包名 <em>tutu</em> 。</p>
<ul>
<li>分隔模块</li>
</ul>
<p>在 src/lib.rs 中可以使用 <code>mod</code> 声明多个模块，但有时为了可读性，习惯将每个模块写在独立的文件中。</p>
<p>新建 src/greeting.rs，写入</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/greeting.rs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">hello</span>(name: &amp;<span class="type">str</span>) &#123; <span class="built_in">println!</span>(<span class="string">&quot;Hello, &#123;&#125;&quot;</span>, &amp;name) &#125;</span><br></pre></td></tr></table></figure>

<p>在 src/lib.rs 可以这样使用，</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/lib.rs</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> greeting;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">func</span>() &#123;</span><br><span class="line">    greeting::<span class="title function_ invoke__">hello</span>(<span class="string">&quot;Tom&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关键点就在于<code>mod greeting;</code>这一行，<code>mod greeting</code>后面没有具体实现，而是紧跟分号，则声明 greeting 的模块内容位于 src/greeting.rs 中。</p>
<p>其他crate，例如 src/main.rs 中的使用方式没有任何变化。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main.rs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> tutu::greeting;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    greeting::<span class="title function_ invoke__">hello</span>(<span class="string">&quot;Jack&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-测试"><a href="#6-测试" class="headerlink" title="6 测试"></a>6 测试</h2><h3 id="6-1-单元测试-unit-tests"><a href="#6-1-单元测试-unit-tests" class="headerlink" title="6.1 单元测试(unit tests)"></a>6.1 单元测试(unit tests)</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">plus</span>(x: <span class="type">i32</span>, y: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; + &#123;&#125; = &#123;&#125;&quot;</span>, x, y, <span class="title function_ invoke__">plus</span>(x, y))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">it_works</span>() &#123;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">4</span>, <span class="title function_ invoke__">plus</span>(<span class="number">2</span>, <span class="number">2</span>), );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>单元测试非常简单，只需要在每一个测试用例前加上 <code>#[test]</code> 即可，通过 <em>cargo test</em> 执行用例。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cargo <span class="built_in">test</span></span><br><span class="line">running 1 <span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span> it_works ... ok</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span> result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out</span><br></pre></td></tr></table></figure>

<p>更规范的写法是在每个源文件中，创建包含测试函数的 tests 模块，测试用例写在 tests 模块中，并使用 <code>cfg(test)</code> 标注模块。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">plus</span>(x: <span class="type">i32</span>, y: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;2 + 3 = &#123;&#125;&quot;</span>, <span class="title function_ invoke__">plus</span>(<span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">it_works</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="number">4</span>, <span class="title function_ invoke__">plus</span>(<span class="number">2</span>, <span class="number">2</span>), );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为内部测试的代码和源码在同一文件，因而需要使用 <code>#[cfg(test)]</code> 注解告诉 Rust 只在执行 cargo test 时才编译和运行测试代码，因此，可以在构建库时节省时间，并减少编译文件产生的文件大小。</p>
<p>单元测试的好处在于，可以测试私有函数。如果在独立的目录，例如 tests 下做测试，则只允许测试公开接口，即使用 <code>pub</code> 修饰后的模块和函数。</p>
<h3 id="6-2-集成测试-integration-tests"><a href="#6-2-集成测试-integration-tests" class="headerlink" title="6.2 集成测试(integration tests)"></a>6.2 集成测试(integration tests)</h3><p>集成测试用例和源码位于不同的目录，因而源码中的模块和函数，对于集成测试来说完全是外部的，因此，只能调用一部分库暴露的公共API。Cargo 约定集成测试的代码位于项目根路径下的 tests 目录中，Cargo 会将 tests 中的每一个文件当做一个 <code>crate</code> 来编译。</p>
<p>只有库 crate 才会向其他 crate 暴露可供调用的函数，因此在 src/main.rs 中定义的函数不能够通过 <code>extern crate</code> 的方式导入，所以也不能够被集成测试。</p>
<p>src/main.rs 定义了 main 函数，即作为一个可执行(Executable)程序入口，目的是独立运行，而非向其他 crate 提供可供调用的接口。</p>
<p>我们将 <em>plus</em> 函数移动到 src/lib.rs 中，新建 tests/test_lib.rs，最终的目录结构如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">├── Cargo.toml</span><br><span class="line">├── src</span><br><span class="line">│   └── lib.rs</span><br><span class="line">│   └── main.rs</span><br><span class="line">├── tests</span><br><span class="line">    └── test_lib.rs</span><br></pre></td></tr></table></figure>

<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/lib.rs</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">plus</span>(x: <span class="type">i32</span>, y: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123; <span class="comment">// plus 必须是公共API，才能被集成测试。</span></span><br><span class="line">    x + y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// src/main.rs</span><br><span class="line"></span><br><span class="line">use tutu;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    println!(&quot;2 + 3 = &#123;&#125;&quot;, tutu::plus(2, 3));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tests/test_lib.rs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> tutu;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">it_works</span>() &#123;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">4</span>, tutu::<span class="title function_ invoke__">plus</span>(<span class="number">2</span>, <span class="number">2</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行 <em>cargo test</em>，将输出</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">running <span class="number">1</span> test</span><br><span class="line">test it_adds_two ... ok</span><br><span class="line"></span><br><span class="line">test result: ok. <span class="number">1</span> passed; <span class="number">0</span> failed; <span class="number">0</span> ignored; <span class="number">0</span> measured; <span class="number">0</span> filtered out</span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://doc.rust-lang.org/stable/book/">Rust 官方指南</a></li>
<li><a target="_blank" rel="noopener" href="https://doc.rust-lang.org/stable/std">Rust 官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://doc.rust-lang.org/stable/cargo/">Cargo 官方文档</a></li>
</ul>

        
<script src="/js/qrious.min.js"></script>


        <hr style="margin-top: 2rem;">
        <div>
            
            <p>
                <span>专题: </span>
                
                <a href="/series/#Rust 简明教程">
                    <code key="Rust 简明教程" class="post-label">Rust 简明教程</code>
                </a>
                
            </p>
            
            <p>
                <span>本文发表于 2019-11-24，最后修改于 2026-02-23。</span>
            </p>
            <!-- 文章末尾的提示 start -->
            
            <p>
                本站永久域名「 <a
                        href="/post/quick-rust.html">geektutu.com</a>
                    」，也可搜索「 极客兔兔 」找到我。
            </p>
            
            
                
            <!-- 文章末尾的提示 end -->
        </div>
        <hr />
        <p name="pagination" style="font-size: 1.2em">
    
    <a class="float-left" href="/post/gee-day6.html">上一篇 « Go语言动手写Web框架 - Gee第六天 模板(HTML Template)</a>
    
    
    <a class="float-right" href="/post/awesome-config.html">下一篇 » WSL, Git, Mircosoft Terminal 等常用工具配置</a>
    
</p>
    </article>
    <!-- 赞赏 -->
    <!--打赏-->

<style>
    #reward .reward-btn-wrapper {
        width: 100px;
        padding-top: 35px;
        cursor: pointer;
        margin: 0 auto;
    }

    #reward .reward-btn {
        padding: 2px 15px;
        color: #fff;
        background-color: #ea6f5a;
        border-radius: 20px;
    }

    #reward .reward-code {
        position: absolute;
        top: -220px;
        left: 50%;
        display: none;
        width: 360px;
        height: 240px;
        margin-left: -180px;
        padding: 15px 20px;
        border: 1px solid #e6e6e6;
        background: #fff;
        box-shadow: 0 1px 1px 1px #efefef;
    }

    #reward .reward-code:after,
    #reward .reward-code:before {
        position: absolute;
        content: '';
        border: 10px solid transparent
    }

    #reward .reward-code:after {
        bottom: -19px;
        left: 50%;
        margin-left: -10px;
        border-top-color: #fff
    }

    #reward .reward-code:before {
        bottom: -20px;
        left: 50%;
        margin-left: -10px;
        border-top-color: #e6e6e6
    }

    #reward .qr-code {
        width: 50%;
        float: left;
        padding: 5px;
    }

    #reward .qr-code p {
        margin-top: -6px;
    }

    #reward img {
        transform: none;
        -webkit-transform: none;
        margin-left: 0;
    }

    #reward img[alt='i'] {
        width: 20px;
        height: 20px;
        z-index: 2;
        position: absolute;
        margin: 65px 0 0 65px;
    }

    #reward img[alt="ali"] {
        width: 100%;
        box-sizing: border-box;
        border: 5px solid #0f9be0;
    }

    #reward img[alt="wechat"] {
        width: 100%;
        box-sizing: border-box;
        border: 5px solid #3db034;
    }

    #reward .reward-tip {
        font-size: 1.2em;
        margin-bottom: 0;
        color: #ea6f5a;
    }
</style>
<div id="reward" class="col-xs-12">
    <div class="reward-btn-wrapper">
        <div class="reward-btn text-center">赞赏支持</div>
    </div>
    <div class="reward-code text-center">
        <p class="text-center reward-tip"><strong>请我吃胡萝卜 =^_^= </strong></p>
        <div class="qr-code">
            <img src="/img/icon.png" alt="i">
            <img id="reward-ali" src="" alt="ali">
            <p><small>支付宝</small></p>
        </div>
        <div class="qr-code">
            <img src="/img/icon.png" alt="i">
            <img id="reward-wechat" src="" alt="wechat">
            <p><small>微信</small></p>
        </div>
    </div>
</div>
<script>
    (function (window, document) {
        var aliQr = new QRious({ value: 'HTTPS://QR.ALIPAY.COM/FKX060337TUXBAX9LIFJE8' });
        var wechatQr = new QRious({ value: 'wxp://f2f0qgGBlfD1nZXjvBjievxB0z0fc0W2sBq5' });
        document.querySelector('#reward-ali').src = aliQr.toDataURL();
        document.querySelector('#reward-wechat').src = wechatQr.toDataURL();

        var rewardBtn = document.querySelector('#reward .reward-btn-wrapper');
        var qrCode = document.querySelector('#reward .reward-code')
        var activeFunc = function (e) {
            qrCode.style.display = 'block';
        }
        var hideFunc = function (e) {
            qrCode.style.display = 'none';
        }

        rewardBtn.addEventListener('mouseenter', activeFunc, false)
        rewardBtn.addEventListener('mouseover', activeFunc, false)
        rewardBtn.addEventListener('mouseleave', hideFunc, false)
        qrCode.addEventListener('mouseenter', activeFunc, false)
        qrCode.addEventListener('mouseover', activeFunc, false)
        qrCode.addEventListener('mouseleave', hideFunc, false)
    })(window, document);
</script>

    
<div class="col-xs-12 text-center" style="margin-top: 30px;">
    
    <a style="display:inline-block;" target="_blank" rel="noopener" href="https://github.com/geektutu" title="Github"><img style="padding:5px;width:30px;margin-left:0;transform:none;-webkit-transform:none;" src="/img/related_links/github.png" /></a>
    
    <a style="display:inline-block;" href="https://geektutu.com/feed.xml" title="RSS"><img style="padding:5px;width:30px;margin-left:0;transform:none;-webkit-transform:none;" src="/img/related_links/rss.jpg" /></a>
    
    <a style="display:inline-block;" target="_blank" rel="noopener" href="https://www.zhihu.com/people/gzdaijie" title="知乎"><img style="padding:5px;width:30px;margin-left:0;transform:none;-webkit-transform:none;" src="/img/related_links/zhihu.png" /></a>
    
    <a style="display:inline-block;" target="_blank" rel="noopener" href="https://weibo.com/geektutu" title="微博"><img style="padding:5px;width:30px;margin-left:0;transform:none;-webkit-transform:none;" src="/img/related_links/weibo.jpg" /></a>
    
</div>

    <!-- 推荐阅读三篇文章 -->
    <div class="col-xs-12">
        <h3>推荐阅读</h3>
        
        <div class="post-preview">
    <div class="post-img" style="background-image: url('/post/hpg-mutex/concurrent.jpg')"></div>
    <div class="post-info">
        <div class="post-info-center">
            <div class="hidden-xs">
                
                
                <span>/</span>
                
                <a class="text-gray" href="/tags/#Go语言高性能编程"
                    title="Go语言高性能编程">Go语言高性能编程</a>
                <span>/</span>
                
                
            </div>
            <a href="/post/hpg-mutex.html" class="title">
                读写锁和互斥锁的性能比较
            </a>
            <p class="text-gray">
                <small>
                    <span>发表于2020-12-05，</span>
                    <span class="hidden-xs">全文6076字，</span>
                    <span>阅读约21分钟</span>
                </small>
            </p>
        </div>
    </div>
</div>
        
        <div class="post-preview">
    <div class="post-img" style="background-image: url('/post/geecache-day2/concurrent_cache_logo.jpg')"></div>
    <div class="post-info">
        <div class="post-info-center">
            <div class="hidden-xs">
                
                
                <span>/</span>
                
                <a class="text-gray" href="/tags/#Go"
                    title="Go">Go</a>
                <span>/</span>
                
                
            </div>
            <a href="/post/geecache-day2.html" class="title">
                动手写分布式缓存 - GeeCache第二天 单机并发缓存
            </a>
            <p class="text-gray">
                <small>
                    <span>发表于2020-02-12，</span>
                    <span class="hidden-xs">全文10228字，</span>
                    <span>阅读约35分钟</span>
                </small>
            </p>
        </div>
    </div>
</div>
        
        <div class="post-preview">
    <div class="post-img" style="background-image: url('/post/awesome-config/wsl.jpg')"></div>
    <div class="post-info">
        <div class="post-info-center">
            <div class="hidden-xs">
                
                
                <span>/</span>
                
                <a class="text-gray" href="/tags/#百宝箱"
                    title="百宝箱">百宝箱</a>
                <span>/</span>
                
                
            </div>
            <a href="/post/awesome-config.html" class="title">
                WSL, Git, Mircosoft Terminal 等常用工具配置
            </a>
            <p class="text-gray">
                <small>
                    <span>发表于2019-12-03，</span>
                    <span class="hidden-xs">全文4850字，</span>
                    <span>阅读约17分钟</span>
                </small>
            </p>
        </div>
    </div>
</div>
        
    </div>
    <div class="col-xs-12">
        <!-- 标签列表 -->
        <!-- Featured Tags -->
<style>
    #featured-tag .post-tag-item {
        font-size: 12px;
        line-height: 30px;
        display: inline-block;
        height: 30px;
        margin: 5px 0px;
        padding: 0 7px;
        color: #333;
        border-radius: 15px;
        background: #f6f6f6;
    }

    #featured-tag .post-tag-item:hover {
        color: #337ab7;
    }
</style>
<div id="featured-tag">
    
    <a class="post-tag-item" href="/tags/#关于我" title="关于我"
        rel="9">#关于我 (9) </a>
    
    <a class="post-tag-item" href="/tags/#Go" title="Go"
        rel="48">#Go (48) </a>
    
    <a class="post-tag-item" href="/tags/#百宝箱" title="百宝箱"
        rel="2">#百宝箱 (2) </a>
    
    <a class="post-tag-item" href="/tags/#Cheat Sheet" title="Cheat Sheet"
        rel="1">#Cheat Sheet (1) </a>
    
    <a class="post-tag-item" href="/tags/#Go语言高性能编程" title="Go语言高性能编程"
        rel="20">#Go语言高性能编程 (20) </a>
    
    <a class="post-tag-item" href="/tags/#友链" title="友链"
        rel="1">#友链 (1) </a>
    
    <a class="post-tag-item" href="/tags/#Pandas" title="Pandas"
        rel="3">#Pandas (3) </a>
    
    <a class="post-tag-item" href="/tags/#机器学习" title="机器学习"
        rel="9">#机器学习 (9) </a>
    
    <a class="post-tag-item" href="/tags/#Python" title="Python"
        rel="10">#Python (10) </a>
    
    <a class="post-tag-item" href="/tags/#Rust" title="Rust"
        rel="1">#Rust (1) </a>
    
    <a class="post-tag-item" href="/tags/#TensorFlow" title="TensorFlow"
        rel="9">#TensorFlow (9) </a>
    
    <a class="post-tag-item" href="/tags/#mnist" title="mnist"
        rel="5">#mnist (5) </a>
    
    <a class="post-tag-item" href="/tags/#强化学习" title="强化学习"
        rel="3">#强化学习 (3) </a>
    
    <a class="post-tag-item" href="/tags/#OpenAI gym" title="OpenAI gym"
        rel="4">#OpenAI gym (4) </a>
    
    <a class="post-tag-item" href="/tags/#DQN" title="DQN"
        rel="1">#DQN (1) </a>
    
    <a class="post-tag-item" href="/tags/#Q-Learning" title="Q-Learning"
        rel="1">#Q-Learning (1) </a>
    
    <a class="post-tag-item" href="/tags/#CNN" title="CNN"
        rel="1">#CNN (1) </a>
    
    <a class="post-tag-item" href="/tags/#TensorFlow 2" title="TensorFlow 2"
        rel="10">#TensorFlow 2 (10) </a>
    
    <a class="post-tag-item" href="/tags/#官方文档" title="官方文档"
        rel="10">#官方文档 (10) </a>
    
</div>
    </div>
    <!-- 评论 -->
    
    <div class="col-xs-12">
        
<div class="col-xs-12 padding-0">
    <div id="gitalk-container">
        <div class="gt-container text-center" style="margin-top: 50px;">
            <button class="gt-btn gt-btn-public"><span class="gt-btn-text">去 Github 评论</span></button>
        </div>
    </div>
    <div id="gitalk-related"></div>
</div>

<link rel="stylesheet" href="/css/gitalk.css">


<script src="/js/gitalk.min.js"></script>

<script>
    window.addEventListener('load', function () {
        function renderCommentUrl(data) {
            var url = (data[window.location.pathname] || {}).url
            url && getDom('#gitalk-container button').addEventListener('click', function (e) { window.open(url)})
            url || (getDom('#gitalk-container').style.display = 'none')
        }
        const gitalk = new Gitalk({
            clientID: 'c1fdd456a4caae5f7df0',
            clientSecret: 'b2674451e21feae50520f99337ec15d2aebe7879',
            accessToken: '513dc2f1e6df8c07a12fbf1547874f54679d9712',
            repo: 'blog',
            owner: 'geektutu',
            admin: ['geektutu'],
            id: window.location.pathname,
            distractionFreeMode: false
        });
        fetch("https://api.github.com/user").then(function(resp){
            gitalk.render('gitalk-container');
        }).catch(function(e){
            fetch('/tool/issues.json').then(function (r) { return r.json() }).then(renderCommentUrl).catch(function (e) { })
        })
        getDom('#gitalk-container').addEventListener('click', function (e) {
            e && e.stopPropagation && e.stopPropagation();
        });
    })
</script>
<script>
    window.addEventListener('load', function () {
        function render(comments) {
            var template = '<a href="${comment.url}?utm_source=gitalk" class="dis-item-url"><h3 class="dis-item-title">${comment.title}</h3>' +
                '<p class="dis-item-des">${comment.count} 评论 ● ${comment.date}</p>' +
                '<div class="dis-item-content"><img class="dis-item-img" src="${comment.icon}" alt="icon"><p><b><span class="dis-item-user">${comment.user}</span></b>&nbsp;——&nbsp;${comment.body}</p></div>' +
                '</a>'

            var wrapper = getDom('#gitalk-related');
            comments = shuffle(comments);
            comments.slice(0, 4).forEach(function (c) {
                var div = document.createElement('div');
                div.classList.add('dis-item');
                div.innerHTML = template.replace("${comment.url}", c.url)
                    .replace("${comment.title}", c.title)
                    .replace("${comment.count}", c.count)
                    .replace("${comment.date}", c.date)
                    .replace("${comment.icon}", c.icon)
                    .replace("${comment.user}", c.user)
                    .replace("${comment.body}", c.body)
                wrapper.appendChild(div)
            })
            var p = document.createElement('p')
            p.innerHTML = '<a href="https://geektutu.com/post/blog-experience-7.html">Gitalk Plus</a>';
            p.classList.add('dis-divide');
            wrapper.appendChild(p);
            wrapper.classList.add('dis-wrapper')
        }
        function shuffle(a) {
            for (var i = a.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
            return a;
        }
        fetch('/tool/comments.json').then(function (r) { return r.json() }).then(render).catch(function (e) { })
    })
</script>

    </div>
    
</div>
<aside class="float-left gkt-sidebar hidden-xs hidden-sm">
    <div style="clear: both"></div>
    <div class="gkt-sidebar-wrapper">
        <section class="box-shadow"><style>
    .gkt-summary {
        border: 1px solid #DDDDDD;
        border-radius: 3px;
        padding: 5px;
        width: 100%;
    }


    .gkt-summary nav {
        overflow: hidden;
    }

    .gkt-summary nav a {
        display: inline-block;
        text-align: center;
        color: #333;
        font-size: 12px;
    }

    .gkt-summary nav span {
        display: block;
    }

    .gkt-summary nav .middle {
        border-left: 1px solid #eaecef;
        border-right: 1px solid #eaecef;
    }

    .gkt-summary .number {
        font-weight: bold;
    }

    .gkt-summary .link-list {
        margin-top: 5px;
        margin-bottom: -5px;
        padding-top: 7px;
        border-top: 1px dashed #999;
        display: flex;
    }

    .gkt-summary .link-list a {
        flex: 1;
    }

    .gkt-summary .link-list img {
        width: 25px;
        height: 25px;
    }
</style>

<div class="gkt-summary">
    <nav>
        <a href="/" class="col-xs-4">
            <span class="number">108</span><span>文章</span>
        </a>
        <a href="/series" class="col-xs-4 middle">
            <span class="number">23</span><span>专题</span>
        </a>
        <a href="/tags" class="col-xs-4">
            <span class="number">19</span><span>标签</span>
        </a>
    </nav>

    
    <div class="link-list">
        
        <a target="_blank" rel="noopener" href="https://github.com/geektutu"><img src="/img/related_links/github.png" /></a>
        
        <a href="https://geektutu.com/feed.xml"><img src="/img/related_links/rss.jpg" /></a>
        
        <a target="_blank" rel="noopener" href="https://www.zhihu.com/people/gzdaijie"><img src="/img/related_links/zhihu.png" /></a>
        
        <a target="_blank" rel="noopener" href="https://weibo.com/geektutu"><img src="/img/related_links/weibo.jpg" /></a>
        
    </div>
    
</div></section>
        
        
        <section class="gkt-sidebar-content box-shadow">
            <strong>Rust 简明教程</strong>
            <ul>
                
                <li>
                    <a href="/post/quick-rust.html"
                        class="gkt-sidebar-active">Rust 简明教程</a>
                    
                    <!-- Table of Contents -->
<div id="sidebar-toc">
  <!-- TOC  -->
  
  
  <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#1-Hello-World"><span class="toc-nav-text">1. Hello World</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#2-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-nav-text">2 基本概念</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#3-%E5%85%B6%E4%BB%96%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-nav-text">3. 其他数据类型</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#4-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-nav-text">4 错误处理</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#5-%E5%8C%85%E3%80%81crate%E5%92%8C%E6%A8%A1%E5%9D%97"><span class="toc-nav-text">5 包、crate和模块</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#6-%E6%B5%8B%E8%AF%95"><span class="toc-nav-text">6 测试</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E5%8F%82%E8%80%83"><span class="toc-nav-text">参考</span></a></li></ol>
  
</div>

<script>
  (function () {
    var h2 = document.querySelectorAll('article h2');
    var h3 = document.querySelectorAll('article h3');
    var linkList = document.querySelectorAll('#sidebar-toc a');

    function findLinkElement(name) {
      for (var i = 0; i < linkList.length; i++) {
        var items = linkList[i].href.split('#');
        if (items && items[items.length - 1] === encodeURIComponent(name)) {
          return i;
        }
      }
      return -1;
    }

    function activeLink(titleList) {
      var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
      for (var i = titleList.length - 1; i >= 0; i--) {
        if (scrollTop - titleList[i].offsetTop > 0) {
          var index = findLinkElement(titleList[i].id);
          index != -1 && linkList[index].classList.add('gkt-sidebar-active');
          break;
        }
      }
    }

    window.addEventListener("scroll", function (e) {
      [].slice.call(linkList).forEach(function (link) {
        link.classList.remove('gkt-sidebar-active');
      })
      activeLink(h2);
    })
  })();
</script>
                    
                </li>
                
            </ul>
        </section>
        
        
        <section class="gkt-sidebar-content box-shadow">
            <strong>最近的文章</strong>
            <ul>
                
                <li>
                    <a href="/post/hpg-sync-cond.html">Go sync.Cond</a>
                </li>
                
                <li>
                    <a href="/post/hpg-dead-code-elimination.html">Go 死码消除与调试(debug)模式</a>
                </li>
                
                <li>
                    <a href="/post/hpg-sync-once.html">Go sync.Once</a>
                </li>
                
            </ul>
        </section>
        
    </div>
</aside>

<script>
    (function () {
        function resizeUArrow() {
            var s = getDom('.u-arrow-wrapper').style
            var pc = getDom('.post-container')
            s.left = getPosition(pc).x + 'px';
            s.width = pc.clientWidth + 'px';
        }
        resizeUArrow()
        window.addEventListener('resize', resizeUArrow);
    })();
</script>

    

<script>
    (function () {
        var ele = getDom('.gkt-sidebar-content')
        if(!ele) return;
        var wrapper = getDom('.gkt-sidebar-wrapper')
        var last = 0
        ele.style.maxHeight = ((window.innerHeight || 798) - 200) + 'px'
        var f = function (e) {
            var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
            var isDown = scrollTop > last;
            var pos = getPosition(ele).y - scrollTop;
            var downLimit = 50;
            var upLimit = -100;
            // uarrow.style.marginTop = scrollTop + 'px';
            isDown && pos <= downLimit && wrapper.classList.add("gkt-sidebar-fixed");
            !isDown && pos > upLimit && wrapper.classList.remove("gkt-sidebar-fixed");
            last = scrollTop
        }
        f()
        window.addEventListener("scroll", f)
    })();
</script>

</main>
    </div>
    <style>
    img#go-top {
        position: fixed;
        bottom: 100px;
        width: 50px;
        cursor: pointer;
        z-index: 9999;
    }
</style>
<img id="go-top" src="/icon/top.png" class="hidden-xs" style="display: none" />
<script>
    (function () {
        var goTop = document.getElementById('go-top');
        var mainContainer = document.querySelector('.main-container');
        
        goTop.addEventListener('click', function () {
            window.scroll(0, 0);
        }, false);
        window.addEventListener('scroll', function () {
            var right = document.body.offsetWidth - mainContainer.getBoundingClientRect().right;
            var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
            goTop.style.right = right + 10 + 'px'
            scrollTop > 700 && (goTop.style.display = "block");
            scrollTop <= 700 && (goTop.style.display = "none");
        });
    })();
</script>
    <style>
    #geektutu-click-img-container {
        position: fixed;
        left: 0;
        top: 0;
        text-align: center;
        width: 100%;
        display: none;
        z-index: 9999;
    }

    #geektutu-click-img-container img {
        object-fit: contain;
        background: #eaecef;
        padding: 15px;
        border-radius: 10px;
        height: auto;
        width: auto;
        vertical-align: middle;
    }
</style>


<div id="geektutu-click-img-container">
    <img src="" alt="Big Image">
</div>

<script>
    (function () {
        var container = document.querySelector('#geektutu-click-img-container')
        var targetImg = container.querySelector('img')
        var imgs = document.querySelectorAll('article img');
        targetImg.addEventListener('click', function (e) {
            container.style.display = 'none';
            e && e.stopPropagation && e.stopPropagation();
        }, false);

        for (var i = 0; i < imgs.length; ++i) {
            var img = imgs[i];
            img.addEventListener('click', (function (src, rate) {
                return function (e) {
                    e && e.stopPropagation && e.stopPropagation();
                    if (window.innerWidth < 980) {
                        return
                    }
                    targetImg.style.height = targetImg.style.width = 'auto';
                    if (window.innerWidth / window.innerHeight > rate) {
                        targetImg.style.height = (window.innerHeight - 20) + 'px';
                    } else {
                        targetImg.style.width = (window.innerWidth - 20) + 'px';
                    }
                    container.style.height = window.innerHeight + 'px'
                    container.style.lineHeight = window.innerHeight + 'px'
                    container.style.display = 'block';
                    targetImg.src = src;
                };
            }(img.src, img.width / img.height)), false)
        }
    })();
</script>
    <!-- Footer -->
    <!-- Footer -->
<style>
    footer {
        width: 100%;
        line-height: 1.5;
        padding: 20px;
    }

    footer a {
        color: #333;
        text-decoration: none;
    }

    .footer-hexo img {
        height: 20px;
        margin-bottom: -5px;
    }

    .footer-hexo a {
        color: #337ab7;
    }
</style>
<footer class="text-center col-xs-12">
    <p>
        <small>© 2026 - 极客兔兔 - </small>
        <small>
            <a target="_blank" rel="nofollow noopener" href="http://beian.miit.gov.cn/">沪ICP备18001798号-1</a>
        </small>
    </p>
    <p class="footer-hexo">
        <!-- 但若直接使用或修改主题，请务必保留这段声明 -->
        <small>Powered by <a target="_blank" href="https://hexo.io">Hexo</a> | Theme
            <a target="_blank" href="https://geektutu.com">Geektutu</a>
            <a target="_blank" rel="noopener" href="https://github.com/geektutu/hexo-theme-geektutu">
                <img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAYGBgYHBgcICAcKCwoLCg8ODAwODxYQERAREBYiFRkVFRkVIh4kHhweJB42KiYmKjY+NDI0PkxERExfWl98fKcBBgYGBgcGBwgIBwoLCgsKDw4MDA4PFhAREBEQFiIVGRUVGRUiHiQeHB4kHjYqJiYqNj40MjQ+TERETF9aX3x8p//CABEIACIAUAMBIgACEQEDEQH/xAAcAAABBAMBAAAAAAAAAAAAAAAAAQQFBwIDBgj/2gAIAQEAAAAA9KrHSgAYL5/z6zZGuJd12uugbhq3uKtmuRtix20IS7lTLAfAAAn/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oACAECEAAAAAAB/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAgBAxAAAAAAAf/EADEQAAICAQIEBQEGBwAAAAAAAAECAwQFAAYREhORBxQhUlQxQVFic5KxJDJCYYGC0f/aAAgBAQABPwCFHnjWUzuvN6hV4cANSRLGjO9yRVUcSzMoA7jVXJYe5N0a2dhmk9kc0bN2GvLN8mbuNeWb5M3ca8s3yZu415Y/Jm7jXlm+TN3H/NeVPyZu40vOk3TZywK8wJ+v3EHVM/wsI/Dq2lrxN3Nnca16eti8chSAIoMbzByhMwP14kHVfwIiSaF5c96J6kwwCOTnHsYk8uvCrdmQy1TI4rJuz3cZLyGR/wCd4+YoOf8AEpUjXitubLYPG4paFsUxcuiGe7yc5gTW3LW44szXmobsi3Dhmic2+Z4+vCVH9CpraPiQ+QvbgTJrPFBWd5YpWrmNIIEXiRO32Pqt4p7cnfHk18lFBdmEVW1LVdIZGOrniTt6plrWKaO69yCykDRxwF+LMAewB0Txtr+Sf31VI8tEPw62fZt7N3Humtbpzz13ucX6CGSWMSuzpLyD1eNgeUka3PuvHbaxq3biTMHfkiSNCS78CwU+3Xg7Vu3MhuTcU6cq3Zemn3Eh2dv8Lzcut+29x1atKbHYqLJUhLwyNMwiZ3j9yDWOxUOV3tgb+3No5LDx1pi9+aeIwRlNY6bc+Jv+IFGrhLxtXJZ7VKcw81diiAAEn0JOrkWZyNfbEr0tz27UGQgkuGzXdIIvyowq99bRxk9ffO/L81SZBPZgEEroQroIxxMZOgeNsfkn99QypHGqO4Vl9CDrN4LDZkwyzyyQ2IgRHZrzGCZVP1XnQglT9oOtw4LC7iqV6uRkZoYpxKFSQpzFRw4EjVRMfSrQ1qqwxQxKFjjTgFUD7BoWYR6iVe+mtxt9Zwf9teaj4AdccPu5tedX5A/VrzUR+sy/q1CwksF19VEfDj/cnQRW+qg66cfsXtrpx+xe2unH7F7a6cfsXtrpx+xe2unH7F7a6cfsXtoxx+xe2gAAOA1//8QAFBEBAAAAAAAAAAAAAAAAAAAAMP/aAAgBAgEBPwB//8QAFBEBAAAAAAAAAAAAAAAAAAAAMP/aAAgBAwEBPwB//9k="
                    alt="Github Star">
            </a>
        </small>
    </p>
    
    <p>
        <small>
            <span id="busuanzi_container_site_pv">👁<span id="busuanzi_value_site_pv"></span></span> &nbsp;
            <span id="busuanzi_container_page_pv">📚<span id="busuanzi_value_page_pv"></span></span>
        </small>
    </p>
    
    

</footer>


<script>
    window.addEventListener('load', function () {
        globalAddScript('//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js');
    })
</script>

<!-- Baidu Tongji -->

<script>
    window.addEventListener('load', function () {
        var _hmt = _hmt || [];
        globalAddScript('//hm.baidu.com/hm.js?1a0ec38c52c08db815b0046c2783b1aa')
    })
</script>



<!-- baidu auto push for seo -->
<script>
    window.addEventListener('load', function () {
        var src = 'http://push.zhanzhang.baidu.com/push.js'
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            src = 'https://zz.bdstatic.com/linksubmit/push.js';
        }
        globalAddScript(src);
    })
</script>


<!-- Global site tag (gtag.js) - Google Analytics -->
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-142641425-1');

    window.addEventListener('load', function () {
        globalAddScript('https://www.googletagmanager.com/gtag/js?id=UA-142641425-1');
    });
</script>


    <script>
        // 非本站网址，新开tab页签
        (function () {
            var stopBubble = function (e) {
                e && e.stopPropagation && e.stopPropagation();
            }
            var links = document.querySelectorAll('a');
            [].slice.call(links).forEach(function (item) {
                if (item.href && item.href.indexOf(window.location.host) === -1) {
                    item.target = '_blank'
                }
                // 阻止冒泡，不触发彩蛋。
                item.addEventListener('click', stopBubble, false);
            });
            var article = document.querySelector('article');
            article && article.addEventListener('click', stopBubble, false)
        })();
    </script>
    
</body>

</html>